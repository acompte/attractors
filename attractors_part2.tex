% Options for packages loaded elsewhere
\PassOptionsToPackage{unicode}{hyperref}
\PassOptionsToPackage{hyphens}{url}
\PassOptionsToPackage{dvipsnames,svgnames,x11names}{xcolor}
%
\documentclass[
  letterpaper,
  DIV=11,
  numbers=noendperiod]{scrartcl}

\usepackage{amsmath,amssymb}
\usepackage{iftex}
\ifPDFTeX
  \usepackage[T1]{fontenc}
  \usepackage[utf8]{inputenc}
  \usepackage{textcomp} % provide euro and other symbols
\else % if luatex or xetex
  \usepackage{unicode-math}
  \defaultfontfeatures{Scale=MatchLowercase}
  \defaultfontfeatures[\rmfamily]{Ligatures=TeX,Scale=1}
\fi
\usepackage{lmodern}
\ifPDFTeX\else  
    % xetex/luatex font selection
\fi
% Use upquote if available, for straight quotes in verbatim environments
\IfFileExists{upquote.sty}{\usepackage{upquote}}{}
\IfFileExists{microtype.sty}{% use microtype if available
  \usepackage[]{microtype}
  \UseMicrotypeSet[protrusion]{basicmath} % disable protrusion for tt fonts
}{}
\makeatletter
\@ifundefined{KOMAClassName}{% if non-KOMA class
  \IfFileExists{parskip.sty}{%
    \usepackage{parskip}
  }{% else
    \setlength{\parindent}{0pt}
    \setlength{\parskip}{6pt plus 2pt minus 1pt}}
}{% if KOMA class
  \KOMAoptions{parskip=half}}
\makeatother
\usepackage{xcolor}
\setlength{\emergencystretch}{3em} % prevent overfull lines
\setcounter{secnumdepth}{-\maxdimen} % remove section numbering
% Make \paragraph and \subparagraph free-standing
\ifx\paragraph\undefined\else
  \let\oldparagraph\paragraph
  \renewcommand{\paragraph}[1]{\oldparagraph{#1}\mbox{}}
\fi
\ifx\subparagraph\undefined\else
  \let\oldsubparagraph\subparagraph
  \renewcommand{\subparagraph}[1]{\oldsubparagraph{#1}\mbox{}}
\fi

\usepackage{color}
\usepackage{fancyvrb}
\newcommand{\VerbBar}{|}
\newcommand{\VERB}{\Verb[commandchars=\\\{\}]}
\DefineVerbatimEnvironment{Highlighting}{Verbatim}{commandchars=\\\{\}}
% Add ',fontsize=\small' for more characters per line
\usepackage{framed}
\definecolor{shadecolor}{RGB}{241,243,245}
\newenvironment{Shaded}{\begin{snugshade}}{\end{snugshade}}
\newcommand{\AlertTok}[1]{\textcolor[rgb]{0.68,0.00,0.00}{#1}}
\newcommand{\AnnotationTok}[1]{\textcolor[rgb]{0.37,0.37,0.37}{#1}}
\newcommand{\AttributeTok}[1]{\textcolor[rgb]{0.40,0.45,0.13}{#1}}
\newcommand{\BaseNTok}[1]{\textcolor[rgb]{0.68,0.00,0.00}{#1}}
\newcommand{\BuiltInTok}[1]{\textcolor[rgb]{0.00,0.23,0.31}{#1}}
\newcommand{\CharTok}[1]{\textcolor[rgb]{0.13,0.47,0.30}{#1}}
\newcommand{\CommentTok}[1]{\textcolor[rgb]{0.37,0.37,0.37}{#1}}
\newcommand{\CommentVarTok}[1]{\textcolor[rgb]{0.37,0.37,0.37}{\textit{#1}}}
\newcommand{\ConstantTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{#1}}
\newcommand{\ControlFlowTok}[1]{\textcolor[rgb]{0.00,0.23,0.31}{#1}}
\newcommand{\DataTypeTok}[1]{\textcolor[rgb]{0.68,0.00,0.00}{#1}}
\newcommand{\DecValTok}[1]{\textcolor[rgb]{0.68,0.00,0.00}{#1}}
\newcommand{\DocumentationTok}[1]{\textcolor[rgb]{0.37,0.37,0.37}{\textit{#1}}}
\newcommand{\ErrorTok}[1]{\textcolor[rgb]{0.68,0.00,0.00}{#1}}
\newcommand{\ExtensionTok}[1]{\textcolor[rgb]{0.00,0.23,0.31}{#1}}
\newcommand{\FloatTok}[1]{\textcolor[rgb]{0.68,0.00,0.00}{#1}}
\newcommand{\FunctionTok}[1]{\textcolor[rgb]{0.28,0.35,0.67}{#1}}
\newcommand{\ImportTok}[1]{\textcolor[rgb]{0.00,0.46,0.62}{#1}}
\newcommand{\InformationTok}[1]{\textcolor[rgb]{0.37,0.37,0.37}{#1}}
\newcommand{\KeywordTok}[1]{\textcolor[rgb]{0.00,0.23,0.31}{#1}}
\newcommand{\NormalTok}[1]{\textcolor[rgb]{0.00,0.23,0.31}{#1}}
\newcommand{\OperatorTok}[1]{\textcolor[rgb]{0.37,0.37,0.37}{#1}}
\newcommand{\OtherTok}[1]{\textcolor[rgb]{0.00,0.23,0.31}{#1}}
\newcommand{\PreprocessorTok}[1]{\textcolor[rgb]{0.68,0.00,0.00}{#1}}
\newcommand{\RegionMarkerTok}[1]{\textcolor[rgb]{0.00,0.23,0.31}{#1}}
\newcommand{\SpecialCharTok}[1]{\textcolor[rgb]{0.37,0.37,0.37}{#1}}
\newcommand{\SpecialStringTok}[1]{\textcolor[rgb]{0.13,0.47,0.30}{#1}}
\newcommand{\StringTok}[1]{\textcolor[rgb]{0.13,0.47,0.30}{#1}}
\newcommand{\VariableTok}[1]{\textcolor[rgb]{0.07,0.07,0.07}{#1}}
\newcommand{\VerbatimStringTok}[1]{\textcolor[rgb]{0.13,0.47,0.30}{#1}}
\newcommand{\WarningTok}[1]{\textcolor[rgb]{0.37,0.37,0.37}{\textit{#1}}}

\providecommand{\tightlist}{%
  \setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}\usepackage{longtable,booktabs,array}
\usepackage{calc} % for calculating minipage widths
% Correct order of tables after \paragraph or \subparagraph
\usepackage{etoolbox}
\makeatletter
\patchcmd\longtable{\par}{\if@noskipsec\mbox{}\fi\par}{}{}
\makeatother
% Allow footnotes in longtable head/foot
\IfFileExists{footnotehyper.sty}{\usepackage{footnotehyper}}{\usepackage{footnote}}
\makesavenoteenv{longtable}
\usepackage{graphicx}
\makeatletter
\def\maxwidth{\ifdim\Gin@nat@width>\linewidth\linewidth\else\Gin@nat@width\fi}
\def\maxheight{\ifdim\Gin@nat@height>\textheight\textheight\else\Gin@nat@height\fi}
\makeatother
% Scale images if necessary, so that they will not overflow the page
% margins by default, and it is still possible to overwrite the defaults
% using explicit options in \includegraphics[width, height, ...]{}
\setkeys{Gin}{width=\maxwidth,height=\maxheight,keepaspectratio}
% Set default figure placement to htbp
\makeatletter
\def\fps@figure{htbp}
\makeatother

<style>
#title-slide .title {
  font-size: 0.1em;
  color: #ffffff;
}
</style>
\KOMAoption{captions}{tableheading}
\makeatletter
\makeatother
\makeatletter
\makeatother
\makeatletter
\@ifpackageloaded{caption}{}{\usepackage{caption}}
\AtBeginDocument{%
\ifdefined\contentsname
  \renewcommand*\contentsname{Table of contents}
\else
  \newcommand\contentsname{Table of contents}
\fi
\ifdefined\listfigurename
  \renewcommand*\listfigurename{List of Figures}
\else
  \newcommand\listfigurename{List of Figures}
\fi
\ifdefined\listtablename
  \renewcommand*\listtablename{List of Tables}
\else
  \newcommand\listtablename{List of Tables}
\fi
\ifdefined\figurename
  \renewcommand*\figurename{Figure}
\else
  \newcommand\figurename{Figure}
\fi
\ifdefined\tablename
  \renewcommand*\tablename{Table}
\else
  \newcommand\tablename{Table}
\fi
}
\@ifpackageloaded{float}{}{\usepackage{float}}
\floatstyle{ruled}
\@ifundefined{c@chapter}{\newfloat{codelisting}{h}{lop}}{\newfloat{codelisting}{h}{lop}[chapter]}
\floatname{codelisting}{Listing}
\newcommand*\listoflistings{\listof{codelisting}{List of Listings}}
\makeatother
\makeatletter
\@ifpackageloaded{caption}{}{\usepackage{caption}}
\@ifpackageloaded{subcaption}{}{\usepackage{subcaption}}
\makeatother
\makeatletter
\@ifpackageloaded{tcolorbox}{}{\usepackage[skins,breakable]{tcolorbox}}
\makeatother
\makeatletter
\@ifundefined{shadecolor}{\definecolor{shadecolor}{rgb}{.97, .97, .97}}
\makeatother
\makeatletter
\makeatother
\makeatletter
\makeatother
\ifLuaTeX
  \usepackage{selnolig}  % disable illegal ligatures
\fi
\IfFileExists{bookmark.sty}{\usepackage{bookmark}}{\usepackage{hyperref}}
\IfFileExists{xurl.sty}{\usepackage{xurl}}{} % add URL line breaks if available
\urlstyle{same} % disable monospaced font for URLs
\hypersetup{
  pdftitle={¨},
  colorlinks=true,
  linkcolor={blue},
  filecolor={Maroon},
  citecolor={Blue},
  urlcolor={Blue},
  pdfcreator={LaTeX via pandoc}}

\title{¨}
\author{}
\date{}

\begin{document}
\maketitle
\ifdefined\Shaded\renewenvironment{Shaded}{\begin{tcolorbox}[borderline west={3pt}{0pt}{shadecolor}, breakable, sharp corners, frame hidden, enhanced, boxrule=0pt, interior hidden]}{\end{tcolorbox}}\fi

\begin{Shaded}
\begin{Highlighting}[]
\ImportTok{import}\NormalTok{ plotly.io }\ImportTok{as}\NormalTok{ pio}
\NormalTok{pio.renderers.default }\OperatorTok{=} \StringTok{"plotly\_mimetype+notebook\_connected"}

\NormalTok{colorscale }\OperatorTok{=} \StringTok{"Viridis"}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\ImportTok{from}\NormalTok{ plotly.subplots }\ImportTok{import}\NormalTok{ make\_subplots}
\ImportTok{import}\NormalTok{ plotly.graph\_objects }\ImportTok{as}\NormalTok{ go}
\ImportTok{import}\NormalTok{ numpy }\ImportTok{as}\NormalTok{ np}
\ImportTok{import}\NormalTok{ matplotlib.pyplot }\ImportTok{as}\NormalTok{ plt}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\ImportTok{import}\NormalTok{ brainpy }\ImportTok{as}\NormalTok{ bp}
\ImportTok{import}\NormalTok{ brainpy.math }\ImportTok{as}\NormalTok{ bm}

\NormalTok{bm.enable\_x64()}
\NormalTok{bm.set\_platform(}\StringTok{\textquotesingle{}cpu\textquotesingle{}}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\hypertarget{decision-making}{%
\subsection{Decision Making}\label{decision-making}}

\begin{figure}

{\centering \includegraphics[width=6.25in,height=\textheight]{figs/shadlen_newsome.jpeg}

}

\end{figure}

\href{https://doi.org/10.1152/jn.2001.86.4.1916}{Shadlen and Newsome,
2001}

\hypertarget{double-well-decision-making}{%
\subsection{Double-Well: Decision
Making}\label{double-well-decision-making}}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{WEE }\OperatorTok{=} \FloatTok{2.9}
\NormalTok{WEI }\OperatorTok{=} \OperatorTok{{-}}\DecValTok{1}
\NormalTok{WIE }\OperatorTok{=} \DecValTok{1}
\NormalTok{gamma }\OperatorTok{=} \FloatTok{1.8}
\NormalTok{sigma }\OperatorTok{=} \FloatTok{0.3}

\NormalTok{tauE }\OperatorTok{=} \FloatTok{0.05}

\NormalTok{JI }\OperatorTok{=} \OperatorTok{{-}}\NormalTok{gamma }\OperatorTok{*}\NormalTok{ WEI }\OperatorTok{*}\NormalTok{ WIE}
\NormalTok{JE }\OperatorTok{=}\NormalTok{ WEE }\OperatorTok{{-}}\NormalTok{ JI}

\AttributeTok{@bp.odeint}
\KeywordTok{def}\NormalTok{ int\_s1(s1, t, s2, coh}\OperatorTok{=}\DecValTok{0}\NormalTok{, drive}\OperatorTok{=}\FloatTok{0.1}\NormalTok{, JE}\OperatorTok{=}\NormalTok{JE, JI}\OperatorTok{=}\NormalTok{JI):}
\NormalTok{    fct }\OperatorTok{=} \DecValTok{2}\OperatorTok{*}\NormalTok{s1}\OperatorTok{*}\NormalTok{(}\FloatTok{1.}\OperatorTok{{-}}\NormalTok{s1)}\OperatorTok{/}\NormalTok{tauE}
\NormalTok{    cnv }\OperatorTok{=} \FloatTok{0.5} \OperatorTok{+}\NormalTok{ bm.atanh(}\DecValTok{2}\OperatorTok{*}\NormalTok{s1 }\OperatorTok{{-}} \FloatTok{1.}\NormalTok{)}
    \ControlFlowTok{return} \OperatorTok{{-}}\NormalTok{ cnv }\OperatorTok{*}\NormalTok{ fct }\OperatorTok{+}\NormalTok{ JE}\OperatorTok{*}\NormalTok{s1 }\OperatorTok{*}\NormalTok{ fct }\OperatorTok{{-}}\NormalTok{ JI}\OperatorTok{*}\NormalTok{s2 }\OperatorTok{*}\NormalTok{ fct }\OperatorTok{+}\NormalTok{ (drive }\OperatorTok{+}\NormalTok{ coh) }\OperatorTok{*}\NormalTok{fct}

\AttributeTok{@bp.odeint}
\KeywordTok{def}\NormalTok{ int\_s2(s2, t, s1, coh}\OperatorTok{=}\DecValTok{0}\NormalTok{, drive}\OperatorTok{=}\FloatTok{0.1}\NormalTok{, JE}\OperatorTok{=}\NormalTok{JE, JI}\OperatorTok{=}\NormalTok{JI):}
\NormalTok{    fct }\OperatorTok{=} \DecValTok{2}\OperatorTok{*}\NormalTok{s2}\OperatorTok{*}\NormalTok{(}\FloatTok{1.}\OperatorTok{{-}}\NormalTok{s2)}\OperatorTok{/}\NormalTok{tauE}
\NormalTok{    cnv }\OperatorTok{=} \FloatTok{0.5} \OperatorTok{+}\NormalTok{ bm.atanh(}\DecValTok{2}\OperatorTok{*}\NormalTok{s2 }\OperatorTok{{-}} \FloatTok{1.}\NormalTok{)}
    \ControlFlowTok{return} \OperatorTok{{-}}\NormalTok{ cnv }\OperatorTok{*}\NormalTok{ fct }\OperatorTok{+}\NormalTok{ JE}\OperatorTok{*}\NormalTok{s2 }\OperatorTok{*}\NormalTok{ fct }\OperatorTok{{-}}\NormalTok{ JI}\OperatorTok{*}\NormalTok{s1 }\OperatorTok{*}\NormalTok{ fct }\OperatorTok{+}\NormalTok{ (drive }\OperatorTok{+}\NormalTok{ coh) }\OperatorTok{*}\NormalTok{fct}


\NormalTok{analyzer }\OperatorTok{=}\NormalTok{ bp.analysis.PhasePlane2D(}
\NormalTok{    model}\OperatorTok{=}\NormalTok{[int\_s1, int\_s2],}
\NormalTok{    target\_vars}\OperatorTok{=}\NormalTok{\{}\StringTok{\textquotesingle{}s1\textquotesingle{}}\NormalTok{: [}\DecValTok{0}\NormalTok{, }\DecValTok{1}\NormalTok{], }\StringTok{\textquotesingle{}s2\textquotesingle{}}\NormalTok{: [}\DecValTok{0}\NormalTok{, }\DecValTok{1}\NormalTok{]\},}
\NormalTok{    pars\_update}\OperatorTok{=}\NormalTok{\{}\StringTok{\textquotesingle{}drive\textquotesingle{}}\NormalTok{: }\FloatTok{0.1}\NormalTok{, }\StringTok{\textquotesingle{}coh\textquotesingle{}}\NormalTok{: }\DecValTok{0}\NormalTok{\},}
\NormalTok{    resolutions}\OperatorTok{=}\FloatTok{0.001}\NormalTok{,}
\NormalTok{)}
\NormalTok{analyzer.plot\_vector\_field()}
\NormalTok{analyzer.plot\_nullcline(coords}\OperatorTok{=}\BuiltInTok{dict}\NormalTok{(r2}\OperatorTok{=}\StringTok{\textquotesingle{}r2{-}r1\textquotesingle{}}\NormalTok{),}
\NormalTok{                        x\_style}\OperatorTok{=}\NormalTok{\{}\StringTok{\textquotesingle{}fmt\textquotesingle{}}\NormalTok{: }\StringTok{\textquotesingle{}{-}\textquotesingle{}}\NormalTok{\},}
\NormalTok{                        y\_style}\OperatorTok{=}\NormalTok{\{}\StringTok{\textquotesingle{}fmt\textquotesingle{}}\NormalTok{: }\StringTok{\textquotesingle{}{-}\textquotesingle{}}\NormalTok{\})}
\NormalTok{analyzer.plot\_fixed\_point()}
\NormalTok{plt.gca().set\_box\_aspect(}\DecValTok{1}\NormalTok{)}
\NormalTok{plt.tight\_layout()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
I am creating the vector field ...
I am computing fx-nullcline ...
I am evaluating fx-nullcline by optimization ...
I am computing fy-nullcline ...
I am evaluating fy-nullcline by optimization ...
I am searching fixed points ...
I am trying to find fixed points by optimization ...
    There are 1000 candidates
I am trying to filter out duplicate fixed points ...
    Found 3 fixed points.
    #1 s1=0.07868432358592321, s2=0.5092956390212111 is a stable node.
    #2 s1=0.2424301377225582, s2=0.2424301349866917 is a saddle node.
    #3 s1=0.5092956378341209, s2=0.07868432407838782 is a stable node.
\end{verbatim}

\begin{figure}[H]

{\centering \includegraphics{attractors_part2_files/figure-pdf/cell-5-output-2.pdf}

}

\end{figure}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{dt }\OperatorTok{=} \FloatTok{0.005}
\NormalTok{time }\OperatorTok{=}\NormalTok{ np.arange(}\DecValTok{0}\NormalTok{, }\DecValTok{10}\NormalTok{, dt)}
\NormalTok{Nt }\OperatorTok{=} \BuiltInTok{len}\NormalTok{(time)}

\KeywordTok{def}\NormalTok{ curr\_to\_rate(x):}
    \ControlFlowTok{return}\NormalTok{ (}\DecValTok{1}\OperatorTok{+}\NormalTok{np.tanh(x}\OperatorTok{{-}}\FloatTok{0.5}\NormalTok{))}\OperatorTok{/}\DecValTok{2}

\KeywordTok{def}\NormalTok{ get\_traces(drive, coh):}
    \CommentTok{\# initialize inputs }
\NormalTok{    inputE1 }\OperatorTok{=}\NormalTok{ np.zeros((Nt,))}
\NormalTok{    inputE2 }\OperatorTok{=}\NormalTok{ np.zeros((Nt,))}

\NormalTok{    inputE1[Nt}\OperatorTok{//}\DecValTok{4}\NormalTok{:] }\OperatorTok{=}\NormalTok{ drive }\OperatorTok{+}\NormalTok{ coh}
\NormalTok{    inputE2[Nt}\OperatorTok{//}\DecValTok{4}\NormalTok{:] }\OperatorTok{=}\NormalTok{ drive }\OperatorTok{{-}}\NormalTok{ coh}

\NormalTok{    inpE1 }\OperatorTok{=} \OperatorTok{{-}}\FloatTok{0.005}\OperatorTok{*}\NormalTok{np.ones((Nt,))}
\NormalTok{    inpE2 }\OperatorTok{=} \OperatorTok{{-}}\FloatTok{0.005}\OperatorTok{*}\NormalTok{np.ones((Nt,))}

    \ControlFlowTok{for}\NormalTok{ i }\KeywordTok{in} \BuiltInTok{range}\NormalTok{(Nt}\OperatorTok{{-}}\DecValTok{1}\NormalTok{):}
\NormalTok{        noise }\OperatorTok{=}\NormalTok{ sigma }\OperatorTok{*}\NormalTok{ np.random.randn()}
\NormalTok{        inpE1[i}\OperatorTok{+}\DecValTok{1}\NormalTok{] }\OperatorTok{=}\NormalTok{ inpE1[i] }\OperatorTok{+}\NormalTok{ dt}\OperatorTok{/}\NormalTok{tauE}\OperatorTok{*}\NormalTok{(}\OperatorTok{{-}}\NormalTok{inpE1[i] }\OperatorTok{+}\NormalTok{ JE}\OperatorTok{*}\NormalTok{curr\_to\_rate(inpE1[i]) }\OperatorTok{{-}}\NormalTok{ JI}\OperatorTok{*}\NormalTok{curr\_to\_rate(inpE2[i]) }\OperatorTok{+}\NormalTok{ inputE1[i] }\OperatorTok{+}\NormalTok{ noise)}
\NormalTok{        noise }\OperatorTok{=}\NormalTok{ sigma }\OperatorTok{*}\NormalTok{ np.random.randn()}
\NormalTok{        inpE2[i}\OperatorTok{+}\DecValTok{1}\NormalTok{] }\OperatorTok{=}\NormalTok{ inpE2[i] }\OperatorTok{+}\NormalTok{ dt}\OperatorTok{/}\NormalTok{tauE}\OperatorTok{*}\NormalTok{(}\OperatorTok{{-}}\NormalTok{inpE2[i] }\OperatorTok{+}\NormalTok{ JE}\OperatorTok{*}\NormalTok{curr\_to\_rate(inpE2[i]) }\OperatorTok{{-}}\NormalTok{ JI}\OperatorTok{*}\NormalTok{curr\_to\_rate(inpE1[i]) }\OperatorTok{+}\NormalTok{ inputE2[i] }\OperatorTok{+}\NormalTok{ noise)}

\NormalTok{    rateE1 }\OperatorTok{=}\NormalTok{ curr\_to\_rate(inpE1)}
\NormalTok{    rateE2 }\OperatorTok{=}\NormalTok{ curr\_to\_rate(inpE2)}

    \ControlFlowTok{return}\NormalTok{ rateE1, rateE2, inputE1, inputE2}

\CommentTok{\# Add traces, one for each slider step}

\NormalTok{frames }\OperatorTok{=}\NormalTok{ []}
\ControlFlowTok{for}\NormalTok{ step }\KeywordTok{in} \BuiltInTok{range}\NormalTok{(}\DecValTok{20}\NormalTok{):}
\NormalTok{    fig }\OperatorTok{=}\NormalTok{ make\_subplots(rows}\OperatorTok{=}\DecValTok{2}\NormalTok{, cols}\OperatorTok{=}\DecValTok{1}\NormalTok{, row\_heights}\OperatorTok{=}\NormalTok{[}\FloatTok{0.3}\NormalTok{, }\FloatTok{0.7}\NormalTok{])}
\NormalTok{    rateE1, rateE2, inputE1, inputE2 }\OperatorTok{=}\NormalTok{ get\_traces(}\FloatTok{0.1}\NormalTok{, }\FloatTok{0.}\NormalTok{)}
\NormalTok{    fig.add\_trace(}
\NormalTok{        go.Scatter(}
\NormalTok{            visible}\OperatorTok{=}\VariableTok{True}\NormalTok{,}
\NormalTok{            line}\OperatorTok{=}\BuiltInTok{dict}\NormalTok{(color}\OperatorTok{=}\StringTok{"\#FF0000"}\NormalTok{, width}\OperatorTok{=}\DecValTok{4}\NormalTok{),}
\NormalTok{            name}\OperatorTok{=}\StringTok{"Population 1"}\NormalTok{,}
\NormalTok{            x }\OperatorTok{=}\NormalTok{ time,}
\NormalTok{            y }\OperatorTok{=}\NormalTok{ rateE1,}
\NormalTok{            showlegend }\OperatorTok{=} \VariableTok{False}\NormalTok{),}
\NormalTok{            row }\OperatorTok{=} \DecValTok{2}\NormalTok{, col }\OperatorTok{=} \DecValTok{1}\NormalTok{)}
\NormalTok{    fig.add\_trace(}
\NormalTok{        go.Scatter(}
\NormalTok{            visible}\OperatorTok{=}\VariableTok{True}\NormalTok{,}
\NormalTok{            line}\OperatorTok{=}\BuiltInTok{dict}\NormalTok{(color}\OperatorTok{=}\StringTok{"\#DD0088"}\NormalTok{, width}\OperatorTok{=}\DecValTok{4}\NormalTok{),}
\NormalTok{            name}\OperatorTok{=}\StringTok{"Population 2"}\NormalTok{,}
\NormalTok{            x }\OperatorTok{=}\NormalTok{ time,}
\NormalTok{            y }\OperatorTok{=}\NormalTok{ rateE2,}
\NormalTok{            showlegend }\OperatorTok{=} \VariableTok{False}\NormalTok{),}
\NormalTok{            row }\OperatorTok{=} \DecValTok{2}\NormalTok{, col }\OperatorTok{=} \DecValTok{1}\NormalTok{)}
\NormalTok{    fig.add\_trace(}
\NormalTok{        go.Scatter(}
\NormalTok{            visible}\OperatorTok{=}\VariableTok{True}\NormalTok{,}
\NormalTok{            line}\OperatorTok{=}\BuiltInTok{dict}\NormalTok{(color}\OperatorTok{=}\StringTok{"\#FF0000"}\NormalTok{, width}\OperatorTok{=}\DecValTok{4}\NormalTok{),}
\NormalTok{            name}\OperatorTok{=}\StringTok{""}\NormalTok{,}
\NormalTok{            x }\OperatorTok{=}\NormalTok{ time,}
\NormalTok{            y }\OperatorTok{=}\NormalTok{ inputE1,}
\NormalTok{            showlegend }\OperatorTok{=} \VariableTok{False}\NormalTok{),}
\NormalTok{            row }\OperatorTok{=} \DecValTok{1}\NormalTok{, col }\OperatorTok{=} \DecValTok{1}\NormalTok{)}
\NormalTok{    fig.add\_trace(}
\NormalTok{        go.Scatter(}
\NormalTok{            visible}\OperatorTok{=}\VariableTok{True}\NormalTok{,}
\NormalTok{            line}\OperatorTok{=}\BuiltInTok{dict}\NormalTok{(color}\OperatorTok{=}\StringTok{"\#DD0088"}\NormalTok{, width}\OperatorTok{=}\DecValTok{4}\NormalTok{),}
\NormalTok{            name}\OperatorTok{=}\StringTok{""}\NormalTok{,}
\NormalTok{            x }\OperatorTok{=}\NormalTok{ time,}
\NormalTok{            y }\OperatorTok{=}\NormalTok{ inputE2,}
\NormalTok{            showlegend}\OperatorTok{=}\VariableTok{False}\NormalTok{),}
\NormalTok{            row }\OperatorTok{=} \DecValTok{1}\NormalTok{, col }\OperatorTok{=} \DecValTok{1}\NormalTok{)}

\NormalTok{    fig.update\_xaxes(title\_text}\OperatorTok{=}\StringTok{""}\NormalTok{, }\BuiltInTok{range}\OperatorTok{=}\NormalTok{[}\DecValTok{0}\NormalTok{, }\DecValTok{10}\NormalTok{], row}\OperatorTok{=}\DecValTok{1}\NormalTok{, col}\OperatorTok{=}\DecValTok{1}\NormalTok{)}
\NormalTok{    fig.update\_xaxes(title\_text}\OperatorTok{=}\StringTok{"time (s)"}\NormalTok{, }\BuiltInTok{range}\OperatorTok{=}\NormalTok{[}\DecValTok{0}\NormalTok{, }\DecValTok{10}\NormalTok{], row}\OperatorTok{=}\DecValTok{2}\NormalTok{, col}\OperatorTok{=}\DecValTok{1}\NormalTok{)}
\NormalTok{    fig.update\_yaxes(title\_text}\OperatorTok{=}\StringTok{"current"}\NormalTok{, }\BuiltInTok{range}\OperatorTok{=}\NormalTok{[}\DecValTok{0}\NormalTok{, }\FloatTok{0.25}\NormalTok{], row}\OperatorTok{=}\DecValTok{1}\NormalTok{, col}\OperatorTok{=}\DecValTok{1}\NormalTok{)}
\NormalTok{    fig.update\_yaxes(title\_text}\OperatorTok{=}\StringTok{"rate"}\NormalTok{, }\BuiltInTok{range}\OperatorTok{=}\NormalTok{[}\DecValTok{0}\NormalTok{, }\DecValTok{1}\NormalTok{], row}\OperatorTok{=}\DecValTok{2}\NormalTok{, col}\OperatorTok{=}\DecValTok{1}\NormalTok{)}

\NormalTok{    frames }\OperatorTok{+=}\NormalTok{ [go.Frame(data}\OperatorTok{=}\NormalTok{fig.data, layout}\OperatorTok{=}\NormalTok{fig.layout, name}\OperatorTok{=}\BuiltInTok{str}\NormalTok{(step))]}

    \CommentTok{\#\# store the first frame to reuse later}
    \ControlFlowTok{if}\NormalTok{ step }\OperatorTok{==} \DecValTok{0}\NormalTok{:}
\NormalTok{        first\_fig }\OperatorTok{=}\NormalTok{ fig}

\NormalTok{fig }\OperatorTok{=}\NormalTok{ go.Figure(frames}\OperatorTok{=}\NormalTok{frames)}

\CommentTok{\#\# add the first frame to the figure so it shows up initially}
\NormalTok{fig.add\_traces(first\_fig.data,)}
\NormalTok{fig.layout }\OperatorTok{=}\NormalTok{ first\_fig.layout}

\CommentTok{\#\# the rest is coped from the plotly documentation example on mri volume slices}
\KeywordTok{def}\NormalTok{ frame\_args(duration):}
    \ControlFlowTok{return}\NormalTok{ \{}
            \StringTok{"frame"}\NormalTok{: \{}\StringTok{"duration"}\NormalTok{: duration\},}
            \StringTok{"mode"}\NormalTok{: }\StringTok{"immediate"}\NormalTok{,}
            \StringTok{"fromcurrent"}\NormalTok{: }\VariableTok{True}\NormalTok{,}
            \StringTok{"transition"}\NormalTok{: \{}\StringTok{"duration"}\NormalTok{: }\DecValTok{0}\NormalTok{, }\StringTok{"easing"}\NormalTok{: }\StringTok{"linear"}\NormalTok{\},}
\NormalTok{        \}}

\NormalTok{sliders }\OperatorTok{=}\NormalTok{ [}
\NormalTok{            \{}
                \StringTok{"pad"}\NormalTok{: \{}\StringTok{"b"}\NormalTok{: }\DecValTok{10}\NormalTok{, }\StringTok{"t"}\NormalTok{: }\DecValTok{60}\NormalTok{\},}
                \StringTok{"len"}\NormalTok{: }\FloatTok{0.9}\NormalTok{,}
                \StringTok{"x"}\NormalTok{: }\FloatTok{0.1}\NormalTok{,}
                \StringTok{"y"}\NormalTok{: }\DecValTok{0}\NormalTok{,}
                \StringTok{"steps"}\NormalTok{: [}
\NormalTok{                    \{}
                        \StringTok{"args"}\NormalTok{: [[f.name], frame\_args(}\DecValTok{2000}\NormalTok{)],}
                        \StringTok{"label"}\NormalTok{: }\BuiltInTok{str}\NormalTok{(k),}
                        \StringTok{"method"}\NormalTok{: }\StringTok{"animate"}\NormalTok{,}
\NormalTok{                    \}}
                    \ControlFlowTok{for}\NormalTok{ k, f }\KeywordTok{in} \BuiltInTok{enumerate}\NormalTok{(fig.frames)}
\NormalTok{                ],}
\NormalTok{            \}}
\NormalTok{        ]}

\NormalTok{fig.update\_layout(}
\NormalTok{         title}\OperatorTok{=}\StringTok{\textquotesingle{}\textquotesingle{}}\NormalTok{,}
\NormalTok{         width}\OperatorTok{=}\DecValTok{500}\NormalTok{,}
\NormalTok{         height}\OperatorTok{=}\DecValTok{400}\NormalTok{,}
\NormalTok{         margin}\OperatorTok{=}\BuiltInTok{dict}\NormalTok{(t}\OperatorTok{=}\DecValTok{0}\NormalTok{, b}\OperatorTok{=}\DecValTok{0}\NormalTok{, l}\OperatorTok{=}\DecValTok{0}\NormalTok{, r}\OperatorTok{=}\DecValTok{0}\NormalTok{),}
\NormalTok{         hovermode}\OperatorTok{=}\VariableTok{False}\NormalTok{,}
\NormalTok{         updatemenus }\OperatorTok{=}\NormalTok{ [}
\NormalTok{            \{}
                \StringTok{"buttons"}\NormalTok{: [}
\NormalTok{                    \{}
                        \StringTok{"args"}\NormalTok{: [}\VariableTok{None}\NormalTok{, frame\_args(}\DecValTok{2000}\NormalTok{)],}
                        \StringTok{"label"}\NormalTok{: }\StringTok{"\&\#9654;"}\NormalTok{, }\CommentTok{\# play symbol}
                        \StringTok{"method"}\NormalTok{: }\StringTok{"animate"}\NormalTok{,}
\NormalTok{                    \},}
\NormalTok{                    \{}
                        \StringTok{"args"}\NormalTok{: [[}\VariableTok{None}\NormalTok{], frame\_args(}\DecValTok{2000}\NormalTok{)],}
                        \StringTok{"label"}\NormalTok{: }\StringTok{"\&\#9724;"}\NormalTok{, }\CommentTok{\# pause symbol}
                        \StringTok{"method"}\NormalTok{: }\StringTok{"animate"}\NormalTok{,}
\NormalTok{                    \},}
\NormalTok{                ],}
                \StringTok{"direction"}\NormalTok{: }\StringTok{"left"}\NormalTok{,}
                \StringTok{"pad"}\NormalTok{: \{}\StringTok{"r"}\NormalTok{: }\DecValTok{10}\NormalTok{, }\StringTok{"t"}\NormalTok{: }\DecValTok{70}\NormalTok{\},}
                \StringTok{"type"}\NormalTok{: }\StringTok{"buttons"}\NormalTok{,}
                \StringTok{"x"}\NormalTok{: }\FloatTok{0.1}\NormalTok{,}
                \StringTok{"y"}\NormalTok{: }\DecValTok{0}\NormalTok{,}
\NormalTok{            \}}
\NormalTok{         ],}
\NormalTok{         sliders}\OperatorTok{=}\NormalTok{sliders}
\NormalTok{)}


\NormalTok{config }\OperatorTok{=}\NormalTok{ \{}\StringTok{\textquotesingle{}displayModeBar\textquotesingle{}}\NormalTok{: }\VariableTok{False}\NormalTok{\}}

\NormalTok{fig.show(config}\OperatorTok{=}\NormalTok{config)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
Unable to display output for mime type(s): text/html
\end{verbatim}

\begin{verbatim}
Unable to display output for mime type(s): application/vnd.plotly.v1+json, text/html
\end{verbatim}

\href{https://doi.org/10.1016/s0896-6273(02)01092-9}{Wang 2002},
\href{https://doi.org/10.1523/JNEUROSCI.3733-05.2006}{Wong and Wang
2006}

\hypertarget{double-well-decision-making-1}{%
\subsection{Double well: Decision
making}\label{double-well-decision-making-1}}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{def}\NormalTok{ integral(rate):}
\NormalTok{    lim }\OperatorTok{=} \DecValTok{2}\OperatorTok{*}\NormalTok{rate }\OperatorTok{{-}} \DecValTok{1}
    \ControlFlowTok{return} \FloatTok{0.5}\OperatorTok{*}\NormalTok{rate }\OperatorTok{+} \FloatTok{0.5}\OperatorTok{*}\NormalTok{ (lim}\OperatorTok{*}\NormalTok{np.arctanh(lim) }\OperatorTok{+} \FloatTok{0.5}\OperatorTok{*}\NormalTok{np.log(np.}\BuiltInTok{abs}\NormalTok{(}\DecValTok{1}\OperatorTok{{-}}\NormalTok{lim}\OperatorTok{*}\NormalTok{lim)) }\OperatorTok{{-}}\FloatTok{0.7}\NormalTok{)}\OperatorTok{;}

\KeywordTok{def}\NormalTok{ get\_energy(drive1, drive2):}
\NormalTok{    energy }\OperatorTok{=}\NormalTok{ np.zeros((}\DecValTok{100}\NormalTok{,}\DecValTok{100}\NormalTok{))    }
\NormalTok{    rate1 }\OperatorTok{=}\NormalTok{ np.linspace(}\DecValTok{0}\NormalTok{,}\DecValTok{1}\NormalTok{,}\DecValTok{100}\NormalTok{)}
\NormalTok{    rate2 }\OperatorTok{=}\NormalTok{ np.linspace(}\DecValTok{0}\NormalTok{,}\DecValTok{1}\NormalTok{,}\DecValTok{100}\NormalTok{)}
    \ControlFlowTok{for}\NormalTok{ i, r1 }\KeywordTok{in} \BuiltInTok{enumerate}\NormalTok{(rate1):}
        \ControlFlowTok{for}\NormalTok{ j, r2 }\KeywordTok{in} \BuiltInTok{enumerate}\NormalTok{(rate2):}
\NormalTok{            energy[i,j] }\OperatorTok{=} \OperatorTok{{-}}\FloatTok{0.5}\OperatorTok{*}\NormalTok{JE}\OperatorTok{*}\NormalTok{(r1}\OperatorTok{**}\DecValTok{2} \OperatorTok{+}\NormalTok{ r2}\OperatorTok{**}\DecValTok{2}\NormalTok{) }\OperatorTok{+}\NormalTok{ JI}\OperatorTok{*}\NormalTok{r1}\OperatorTok{*}\NormalTok{r2 }\OperatorTok{{-}}\NormalTok{ (drive1}\OperatorTok{*}\NormalTok{r1 }\OperatorTok{+}\NormalTok{ drive2}\OperatorTok{*}\NormalTok{r2) }\OperatorTok{+}\NormalTok{ integral(r1) }\OperatorTok{+}\NormalTok{ integral(r2)}

    \ControlFlowTok{return}\NormalTok{ energy, rate1, rate2}

\NormalTok{fig }\OperatorTok{=}\NormalTok{ make\_subplots(rows}\OperatorTok{=}\DecValTok{2}\NormalTok{, cols}\OperatorTok{=}\DecValTok{2}\NormalTok{,}
\NormalTok{      specs}\OperatorTok{=}\NormalTok{[[\{}\StringTok{\textquotesingle{}rowspan\textquotesingle{}}\NormalTok{: }\DecValTok{1}\NormalTok{, }\StringTok{\textquotesingle{}colspan\textquotesingle{}}\NormalTok{: }\DecValTok{1}\NormalTok{\}, \{}\StringTok{\textquotesingle{}rowspan\textquotesingle{}}\NormalTok{: }\DecValTok{2}\NormalTok{, }\StringTok{\textquotesingle{}colspan\textquotesingle{}}\NormalTok{: }\DecValTok{1}\NormalTok{\}],}
\NormalTok{       [\{}\StringTok{\textquotesingle{}rowspan\textquotesingle{}}\NormalTok{: }\DecValTok{1}\NormalTok{, }\StringTok{\textquotesingle{}colspan\textquotesingle{}}\NormalTok{: }\DecValTok{1}\NormalTok{\}, }\VariableTok{None}\NormalTok{]], }
\NormalTok{      row\_heights}\OperatorTok{=}\NormalTok{[}\FloatTok{0.3}\NormalTok{, }\FloatTok{0.7}\NormalTok{],}
\CommentTok{\#print\_grid=False,}
\NormalTok{      vertical\_spacing}\OperatorTok{=}\FloatTok{0.12}\NormalTok{,}
\NormalTok{      horizontal\_spacing}\OperatorTok{=}\FloatTok{0.08}\NormalTok{)}
      
\CommentTok{\# Add traces, one for each slider step}
\NormalTok{coh }\OperatorTok{=} \DecValTok{0}
\ControlFlowTok{for}\NormalTok{ drive }\KeywordTok{in}\NormalTok{ np.arange(}\DecValTok{0}\NormalTok{, }\FloatTok{0.2}\NormalTok{, }\FloatTok{0.01}\NormalTok{):}
\NormalTok{    rateE1, rateE2, inputE1, inputE2 }\OperatorTok{=}\NormalTok{ get\_traces(drive, }\FloatTok{0.}\NormalTok{)}
\NormalTok{    fig.add\_trace(}
\NormalTok{        go.Scatter(}
\NormalTok{            visible}\OperatorTok{=}\VariableTok{False}\NormalTok{,}
\NormalTok{            line}\OperatorTok{=}\BuiltInTok{dict}\NormalTok{(color}\OperatorTok{=}\StringTok{"\#FF0000"}\NormalTok{, width}\OperatorTok{=}\DecValTok{4}\NormalTok{),}
\NormalTok{            name}\OperatorTok{=}\StringTok{""}\NormalTok{,}
\NormalTok{            x }\OperatorTok{=}\NormalTok{ time,}
\NormalTok{            y }\OperatorTok{=}\NormalTok{ rateE1,}
\NormalTok{            showlegend}\OperatorTok{=}\VariableTok{False}\NormalTok{),}
\NormalTok{            row }\OperatorTok{=} \DecValTok{2}\NormalTok{, col }\OperatorTok{=} \DecValTok{1}\NormalTok{)}
\NormalTok{    fig.add\_trace(}
\NormalTok{        go.Scatter(}
\NormalTok{            visible}\OperatorTok{=}\VariableTok{False}\NormalTok{,}
\NormalTok{            line}\OperatorTok{=}\BuiltInTok{dict}\NormalTok{(color}\OperatorTok{=}\StringTok{"\#DD0088"}\NormalTok{, width}\OperatorTok{=}\DecValTok{4}\NormalTok{),}
\NormalTok{            name}\OperatorTok{=}\StringTok{""}\NormalTok{,}
\NormalTok{            x }\OperatorTok{=}\NormalTok{ time,}
\NormalTok{            y }\OperatorTok{=}\NormalTok{ rateE2,}
\NormalTok{            showlegend}\OperatorTok{=}\VariableTok{False}\NormalTok{),}
\NormalTok{            row }\OperatorTok{=} \DecValTok{2}\NormalTok{, col }\OperatorTok{=} \DecValTok{1}\NormalTok{)}
\NormalTok{    fig.add\_trace(}
\NormalTok{        go.Scatter(}
\NormalTok{            visible}\OperatorTok{=}\VariableTok{False}\NormalTok{,}
\NormalTok{            line}\OperatorTok{=}\BuiltInTok{dict}\NormalTok{(color}\OperatorTok{=}\StringTok{"\#FF0000"}\NormalTok{, width}\OperatorTok{=}\DecValTok{4}\NormalTok{),}
\NormalTok{            name}\OperatorTok{=}\StringTok{""}\NormalTok{,}
\NormalTok{            x }\OperatorTok{=}\NormalTok{ time,}
\NormalTok{            y }\OperatorTok{=}\NormalTok{ inputE1,}
\NormalTok{            showlegend }\OperatorTok{=} \VariableTok{False}\NormalTok{),}
\NormalTok{            row }\OperatorTok{=} \DecValTok{1}\NormalTok{, col }\OperatorTok{=} \DecValTok{1}\NormalTok{)}
\NormalTok{    fig.add\_trace(}
\NormalTok{        go.Scatter(}
\NormalTok{            visible}\OperatorTok{=}\VariableTok{False}\NormalTok{,}
\NormalTok{            line}\OperatorTok{=}\BuiltInTok{dict}\NormalTok{(color}\OperatorTok{=}\StringTok{"\#DD0088"}\NormalTok{, width}\OperatorTok{=}\DecValTok{4}\NormalTok{),}
\NormalTok{            name}\OperatorTok{=}\StringTok{""}\NormalTok{,}
\NormalTok{            x }\OperatorTok{=}\NormalTok{ time,}
\NormalTok{            y }\OperatorTok{=}\NormalTok{ inputE2,}
\NormalTok{            showlegend}\OperatorTok{=}\VariableTok{False}\NormalTok{),}
\NormalTok{            row }\OperatorTok{=} \DecValTok{1}\NormalTok{, col }\OperatorTok{=} \DecValTok{1}\NormalTok{)}

\NormalTok{    energy, rateE1, rateE2 }\OperatorTok{=}\NormalTok{ get\_energy(drive}\OperatorTok{+}\NormalTok{coh, drive}\OperatorTok{{-}}\NormalTok{coh)}
    \CommentTok{\# energy[energy\textgreater{}{-}0.15]=np.nan}
\NormalTok{    fig.add\_trace(}
\NormalTok{        go.Contour(}
\NormalTok{            visible}\OperatorTok{=}\VariableTok{False}\NormalTok{,}
\NormalTok{            x }\OperatorTok{=}\NormalTok{ rateE1,}
\NormalTok{            y }\OperatorTok{=}\NormalTok{ rateE2,}
\NormalTok{            z }\OperatorTok{=}\NormalTok{ energy,}
\NormalTok{            contours }\OperatorTok{=}\NormalTok{ \{}\StringTok{"start"}\NormalTok{: }\OperatorTok{{-}}\FloatTok{0.5}\NormalTok{, }\StringTok{"end"}\NormalTok{: }\OperatorTok{{-}}\FloatTok{0.2}\NormalTok{, }\StringTok{"size"}\NormalTok{: }\FloatTok{0.002}\NormalTok{, }\StringTok{"coloring"}\NormalTok{:}\StringTok{"lines"}\NormalTok{\},}
\NormalTok{            colorscale}\OperatorTok{=}\NormalTok{colorscale,}
\NormalTok{            colorbar\_title\_text}\OperatorTok{=}\StringTok{\textquotesingle{}energy\textquotesingle{}}
\NormalTok{            ),}
\NormalTok{            row }\OperatorTok{=} \DecValTok{1}\NormalTok{, col }\OperatorTok{=} \DecValTok{2}\NormalTok{)}

\CommentTok{\# Make 10th trace visible}
\NormalTok{mid }\OperatorTok{=} \BuiltInTok{len}\NormalTok{(fig.data)}\OperatorTok{//}\DecValTok{2}
\ControlFlowTok{for}\NormalTok{ i }\KeywordTok{in} \BuiltInTok{range}\NormalTok{(}\DecValTok{5}\NormalTok{):}
\NormalTok{    fig.data[mid}\OperatorTok{+}\NormalTok{i].visible }\OperatorTok{=} \VariableTok{True}

\CommentTok{\# Create and add slider}
\NormalTok{steps }\OperatorTok{=}\NormalTok{ []}
\ControlFlowTok{for}\NormalTok{ i }\KeywordTok{in} \BuiltInTok{range}\NormalTok{(}\BuiltInTok{len}\NormalTok{(fig.data)}\OperatorTok{//}\DecValTok{5}\NormalTok{):}

\NormalTok{    step }\OperatorTok{=} \BuiltInTok{dict}\NormalTok{(}
\NormalTok{        method}\OperatorTok{=}\StringTok{"update"}\NormalTok{,}
\NormalTok{        args}\OperatorTok{=}\NormalTok{[\{}\StringTok{"visible"}\NormalTok{: [}\VariableTok{False}\NormalTok{] }\OperatorTok{*} \BuiltInTok{len}\NormalTok{(fig.data)\}], }
\NormalTok{        label}\OperatorTok{=}\BuiltInTok{str}\NormalTok{(np.around(}\FloatTok{0.01} \OperatorTok{*}\NormalTok{ i,}\DecValTok{2}\NormalTok{)) }\CommentTok{\# layout attribute}
\NormalTok{    )}
\NormalTok{    step[}\StringTok{"args"}\NormalTok{][}\DecValTok{0}\NormalTok{][}\StringTok{"visible"}\NormalTok{][}\DecValTok{5}\OperatorTok{*}\NormalTok{i:}\DecValTok{5}\OperatorTok{*}\NormalTok{i}\OperatorTok{+}\DecValTok{5}\NormalTok{] }\OperatorTok{=}\NormalTok{ [}\VariableTok{True}\NormalTok{]}\OperatorTok{*}\DecValTok{5}  \CommentTok{\# Toggle i\textquotesingle{}th trace to "visible"}
\NormalTok{    steps.append(step)}

\NormalTok{sliders }\OperatorTok{=}\NormalTok{ [}\BuiltInTok{dict}\NormalTok{(}
\NormalTok{    active}\OperatorTok{=}\NormalTok{mid}\OperatorTok{//}\DecValTok{5}\NormalTok{,}
\NormalTok{    currentvalue}\OperatorTok{=}\NormalTok{\{}\StringTok{"prefix"}\NormalTok{: }\StringTok{"Drive: "}\NormalTok{\},}
\NormalTok{    pad}\OperatorTok{=}\NormalTok{\{}\StringTok{"t"}\NormalTok{: }\DecValTok{10}\NormalTok{\},}
\NormalTok{    steps}\OperatorTok{=}\NormalTok{steps}
\NormalTok{)]}

\NormalTok{fig.update\_layout(}
\NormalTok{    sliders}\OperatorTok{=}\NormalTok{sliders, height}\OperatorTok{=}\DecValTok{450}\NormalTok{, width}\OperatorTok{=}\DecValTok{1000}\NormalTok{,}
\NormalTok{    autosize}\OperatorTok{=}\VariableTok{False}\NormalTok{,}
\NormalTok{    margin}\OperatorTok{=}\BuiltInTok{dict}\NormalTok{(t}\OperatorTok{=}\DecValTok{0}\NormalTok{, b}\OperatorTok{=}\DecValTok{0}\NormalTok{, l}\OperatorTok{=}\DecValTok{0}\NormalTok{, r}\OperatorTok{=}\DecValTok{0}\NormalTok{),}
\NormalTok{    template}\OperatorTok{=}\StringTok{"plotly\_white"}\NormalTok{,}
\NormalTok{    hovermode}\OperatorTok{=}\VariableTok{False}\NormalTok{,}
\NormalTok{)}


\NormalTok{fig.update\_xaxes(title\_text}\OperatorTok{=}\StringTok{""}\NormalTok{, }\BuiltInTok{range}\OperatorTok{=}\NormalTok{[}\DecValTok{0}\NormalTok{, }\DecValTok{10}\NormalTok{], row}\OperatorTok{=}\DecValTok{1}\NormalTok{, col}\OperatorTok{=}\DecValTok{1}\NormalTok{)}
\NormalTok{fig.update\_xaxes(title\_text}\OperatorTok{=}\StringTok{"time (s)"}\NormalTok{, }\BuiltInTok{range}\OperatorTok{=}\NormalTok{[}\DecValTok{0}\NormalTok{, }\DecValTok{10}\NormalTok{], row}\OperatorTok{=}\DecValTok{2}\NormalTok{, col}\OperatorTok{=}\DecValTok{1}\NormalTok{)}
\NormalTok{fig.update\_yaxes(title\_text}\OperatorTok{=}\StringTok{"current"}\NormalTok{, }\BuiltInTok{range}\OperatorTok{=}\NormalTok{[}\DecValTok{0}\NormalTok{, }\FloatTok{0.25}\NormalTok{], row}\OperatorTok{=}\DecValTok{1}\NormalTok{, col}\OperatorTok{=}\DecValTok{1}\NormalTok{)}
\NormalTok{fig.update\_yaxes(title\_text}\OperatorTok{=}\StringTok{"rate"}\NormalTok{, }\BuiltInTok{range}\OperatorTok{=}\NormalTok{[}\DecValTok{0}\NormalTok{, }\DecValTok{1}\NormalTok{], row}\OperatorTok{=}\DecValTok{2}\NormalTok{, col}\OperatorTok{=}\DecValTok{1}\NormalTok{)}
\NormalTok{fig.update\_xaxes(title\_text}\OperatorTok{=}\StringTok{"rate 1"}\NormalTok{, }\BuiltInTok{range}\OperatorTok{=}\NormalTok{[}\DecValTok{0}\NormalTok{, }\DecValTok{1}\NormalTok{], row}\OperatorTok{=}\DecValTok{1}\NormalTok{, col}\OperatorTok{=}\DecValTok{2}\NormalTok{)}
\NormalTok{fig.update\_yaxes(title\_text}\OperatorTok{=}\StringTok{"rate 2"}\NormalTok{, }\BuiltInTok{range}\OperatorTok{=}\NormalTok{[}\DecValTok{0}\NormalTok{, }\DecValTok{1}\NormalTok{], row}\OperatorTok{=}\DecValTok{1}\NormalTok{, col}\OperatorTok{=}\DecValTok{2}\NormalTok{)}
\NormalTok{fig.update\_scenes(xaxis\_title\_text}\OperatorTok{=}\StringTok{\textquotesingle{}rate 1\textquotesingle{}}\NormalTok{,  }
\NormalTok{                  yaxis\_title\_text}\OperatorTok{=}\StringTok{\textquotesingle{}rate 2\textquotesingle{}}\NormalTok{, row}\OperatorTok{=}\DecValTok{1}\NormalTok{, col}\OperatorTok{=}\DecValTok{2}\NormalTok{)}

\NormalTok{config }\OperatorTok{=}\NormalTok{ \{}\StringTok{\textquotesingle{}displayModeBar\textquotesingle{}}\NormalTok{: }\VariableTok{False}\NormalTok{\}}

\NormalTok{fig.show(config}\OperatorTok{=}\NormalTok{config)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
/tmp/ipykernel_563129/2187511751.py:3: RuntimeWarning:

divide by zero encountered in arctanh

/tmp/ipykernel_563129/2187511751.py:3: RuntimeWarning:

divide by zero encountered in log

/tmp/ipykernel_563129/2187511751.py:3: RuntimeWarning:

invalid value encountered in scalar add
\end{verbatim}

\begin{verbatim}
Unable to display output for mime type(s): application/vnd.plotly.v1+json, text/html
\end{verbatim}

\hypertarget{double-well-decision-making-2}{%
\subsection{Double well: Decision
making}\label{double-well-decision-making-2}}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{fig }\OperatorTok{=}\NormalTok{ make\_subplots(rows}\OperatorTok{=}\DecValTok{2}\NormalTok{, cols}\OperatorTok{=}\DecValTok{2}\NormalTok{,}
\NormalTok{      specs}\OperatorTok{=}\NormalTok{[[\{}\StringTok{\textquotesingle{}rowspan\textquotesingle{}}\NormalTok{: }\DecValTok{1}\NormalTok{, }\StringTok{\textquotesingle{}colspan\textquotesingle{}}\NormalTok{: }\DecValTok{1}\NormalTok{\}, \{}\StringTok{\textquotesingle{}rowspan\textquotesingle{}}\NormalTok{: }\DecValTok{2}\NormalTok{, }\StringTok{\textquotesingle{}colspan\textquotesingle{}}\NormalTok{: }\DecValTok{1}\NormalTok{\}],}
\NormalTok{       [\{}\StringTok{\textquotesingle{}rowspan\textquotesingle{}}\NormalTok{: }\DecValTok{1}\NormalTok{, }\StringTok{\textquotesingle{}colspan\textquotesingle{}}\NormalTok{: }\DecValTok{1}\NormalTok{\}, }\VariableTok{None}\NormalTok{]], }
\NormalTok{      row\_heights}\OperatorTok{=}\NormalTok{[}\FloatTok{0.3}\NormalTok{, }\FloatTok{0.7}\NormalTok{],}
\CommentTok{\#print\_grid=False,}
\NormalTok{      vertical\_spacing}\OperatorTok{=}\FloatTok{0.12}\NormalTok{,}
\NormalTok{      horizontal\_spacing}\OperatorTok{=}\FloatTok{0.08}\NormalTok{)}
      
\CommentTok{\# Add traces, one for each slider step}

\NormalTok{drive }\OperatorTok{=} \FloatTok{0.1}
\ControlFlowTok{for}\NormalTok{ coh }\KeywordTok{in}\NormalTok{ np.arange(}\OperatorTok{{-}}\FloatTok{0.05}\NormalTok{, }\FloatTok{0.055}\NormalTok{, }\FloatTok{0.01}\NormalTok{):}
\NormalTok{    rateE1, rateE2, inputE1, inputE2 }\OperatorTok{=}\NormalTok{ get\_traces(drive, coh)}
\NormalTok{    fig.add\_trace(}
\NormalTok{        go.Scatter(}
\NormalTok{            visible}\OperatorTok{=}\VariableTok{False}\NormalTok{,}
\NormalTok{            line}\OperatorTok{=}\BuiltInTok{dict}\NormalTok{(color}\OperatorTok{=}\StringTok{"\#FF0000"}\NormalTok{, width}\OperatorTok{=}\DecValTok{4}\NormalTok{),}
\NormalTok{            name}\OperatorTok{=}\StringTok{""}\NormalTok{,}
\NormalTok{            x }\OperatorTok{=}\NormalTok{ time,}
\NormalTok{            y }\OperatorTok{=}\NormalTok{ rateE1,}
\NormalTok{            showlegend}\OperatorTok{=}\VariableTok{False}\NormalTok{),}
\NormalTok{            row }\OperatorTok{=} \DecValTok{2}\NormalTok{, col }\OperatorTok{=} \DecValTok{1}\NormalTok{)}
\NormalTok{    fig.add\_trace(}
\NormalTok{        go.Scatter(}
\NormalTok{            visible}\OperatorTok{=}\VariableTok{False}\NormalTok{,}
\NormalTok{            line}\OperatorTok{=}\BuiltInTok{dict}\NormalTok{(color}\OperatorTok{=}\StringTok{"\#DD0088"}\NormalTok{, width}\OperatorTok{=}\DecValTok{4}\NormalTok{),}
\NormalTok{            name}\OperatorTok{=}\StringTok{""}\NormalTok{,}
\NormalTok{            x }\OperatorTok{=}\NormalTok{ time,}
\NormalTok{            y }\OperatorTok{=}\NormalTok{ rateE2,}
\NormalTok{            showlegend}\OperatorTok{=}\VariableTok{False}\NormalTok{),}
\NormalTok{            row }\OperatorTok{=} \DecValTok{2}\NormalTok{, col }\OperatorTok{=} \DecValTok{1}\NormalTok{)}
\NormalTok{    fig.add\_trace(}
\NormalTok{        go.Scatter(}
\NormalTok{            visible}\OperatorTok{=}\VariableTok{False}\NormalTok{,}
\NormalTok{            line}\OperatorTok{=}\BuiltInTok{dict}\NormalTok{(color}\OperatorTok{=}\StringTok{"\#FF0000"}\NormalTok{, width}\OperatorTok{=}\DecValTok{4}\NormalTok{),}
\NormalTok{            name}\OperatorTok{=}\StringTok{""}\NormalTok{,}
\NormalTok{            x }\OperatorTok{=}\NormalTok{ time,}
\NormalTok{            y }\OperatorTok{=}\NormalTok{ inputE1,}
\NormalTok{            showlegend }\OperatorTok{=} \VariableTok{False}\NormalTok{),}
\NormalTok{            row }\OperatorTok{=} \DecValTok{1}\NormalTok{, col }\OperatorTok{=} \DecValTok{1}\NormalTok{)}
\NormalTok{    fig.add\_trace(}
\NormalTok{        go.Scatter(}
\NormalTok{            visible}\OperatorTok{=}\VariableTok{False}\NormalTok{,}
\NormalTok{            line}\OperatorTok{=}\BuiltInTok{dict}\NormalTok{(color}\OperatorTok{=}\StringTok{"\#DD0088"}\NormalTok{, width}\OperatorTok{=}\DecValTok{4}\NormalTok{),}
\NormalTok{            name}\OperatorTok{=}\StringTok{""}\NormalTok{,}
\NormalTok{            x }\OperatorTok{=}\NormalTok{ time,}
\NormalTok{            y }\OperatorTok{=}\NormalTok{ inputE2,}
\NormalTok{            showlegend}\OperatorTok{=}\VariableTok{False}\NormalTok{),}
\NormalTok{            row }\OperatorTok{=} \DecValTok{1}\NormalTok{, col }\OperatorTok{=} \DecValTok{1}\NormalTok{)}

\NormalTok{    energy, rateE1, rateE2 }\OperatorTok{=}\NormalTok{ get\_energy(drive}\OperatorTok{+}\NormalTok{coh, drive}\OperatorTok{{-}}\NormalTok{coh)}
    \CommentTok{\# energy[energy\textgreater{}{-}0.15]=np.nan}
\NormalTok{    fig.add\_trace(}
\NormalTok{        go.Contour(}
\NormalTok{            visible}\OperatorTok{=}\VariableTok{False}\NormalTok{,}
\NormalTok{            x }\OperatorTok{=}\NormalTok{ rateE1,}
\NormalTok{            y }\OperatorTok{=}\NormalTok{ rateE2,}
\NormalTok{            z }\OperatorTok{=}\NormalTok{ energy,}
\NormalTok{            contours }\OperatorTok{=}\NormalTok{ \{}\StringTok{"start"}\NormalTok{: }\OperatorTok{{-}}\FloatTok{0.5}\NormalTok{, }\StringTok{"end"}\NormalTok{: }\OperatorTok{{-}}\FloatTok{0.2}\NormalTok{, }\StringTok{"size"}\NormalTok{: }\FloatTok{0.002}\NormalTok{, }\StringTok{"coloring"}\NormalTok{:}\StringTok{"lines"}\NormalTok{\},}
\NormalTok{            colorscale}\OperatorTok{=}\NormalTok{colorscale,}
\NormalTok{            colorbar\_title\_text}\OperatorTok{=}\StringTok{\textquotesingle{}energy\textquotesingle{}}
\NormalTok{            ),}
\NormalTok{            row }\OperatorTok{=} \DecValTok{1}\NormalTok{, col }\OperatorTok{=} \DecValTok{2}\NormalTok{)}

\CommentTok{\# Make 10th trace visible}
\NormalTok{mid }\OperatorTok{=} \BuiltInTok{len}\NormalTok{(fig.data)}\OperatorTok{//}\DecValTok{2}
\ControlFlowTok{for}\NormalTok{ i }\KeywordTok{in} \BuiltInTok{range}\NormalTok{(}\DecValTok{5}\NormalTok{):}
\NormalTok{    fig.data[mid}\OperatorTok{+}\NormalTok{i].visible }\OperatorTok{=} \VariableTok{True}

\CommentTok{\# Create and add slider}
\NormalTok{steps }\OperatorTok{=}\NormalTok{ []}
\ControlFlowTok{for}\NormalTok{ i }\KeywordTok{in} \BuiltInTok{range}\NormalTok{(}\BuiltInTok{len}\NormalTok{(fig.data)}\OperatorTok{//}\DecValTok{5}\NormalTok{):}

\NormalTok{    step }\OperatorTok{=} \BuiltInTok{dict}\NormalTok{(}
\NormalTok{        method}\OperatorTok{=}\StringTok{"update"}\NormalTok{,}
\NormalTok{        args}\OperatorTok{=}\NormalTok{[\{}\StringTok{"visible"}\NormalTok{: [}\VariableTok{False}\NormalTok{] }\OperatorTok{*} \BuiltInTok{len}\NormalTok{(fig.data)\}], }
\NormalTok{        label}\OperatorTok{=}\BuiltInTok{str}\NormalTok{(np.around(}\FloatTok{0.01} \OperatorTok{*}\NormalTok{ i }\OperatorTok{{-}} \FloatTok{0.05}\NormalTok{,}\DecValTok{2}\NormalTok{)) }\CommentTok{\# layout attribute}
\NormalTok{    )}
\NormalTok{    step[}\StringTok{"args"}\NormalTok{][}\DecValTok{0}\NormalTok{][}\StringTok{"visible"}\NormalTok{][}\DecValTok{5}\OperatorTok{*}\NormalTok{i:}\DecValTok{5}\OperatorTok{*}\NormalTok{i}\OperatorTok{+}\DecValTok{5}\NormalTok{] }\OperatorTok{=}\NormalTok{ [}\VariableTok{True}\NormalTok{]}\OperatorTok{*}\DecValTok{5}  \CommentTok{\# Toggle i\textquotesingle{}th trace to "visible"}
\NormalTok{    steps.append(step)}

\NormalTok{sliders }\OperatorTok{=}\NormalTok{ [}\BuiltInTok{dict}\NormalTok{(}
\NormalTok{    active}\OperatorTok{=}\NormalTok{mid}\OperatorTok{//}\DecValTok{5}\NormalTok{,}
\NormalTok{    currentvalue}\OperatorTok{=}\NormalTok{\{}\StringTok{"prefix"}\NormalTok{: }\StringTok{"Coherency: "}\NormalTok{\},}
\NormalTok{    pad}\OperatorTok{=}\NormalTok{\{}\StringTok{"t"}\NormalTok{: }\DecValTok{10}\NormalTok{\},}
\NormalTok{    steps}\OperatorTok{=}\NormalTok{steps}
\NormalTok{)]}

\NormalTok{fig.update\_layout(}
\NormalTok{    sliders}\OperatorTok{=}\NormalTok{sliders, height}\OperatorTok{=}\DecValTok{450}\NormalTok{, width}\OperatorTok{=}\DecValTok{1000}\NormalTok{,}
\NormalTok{    autosize}\OperatorTok{=}\VariableTok{False}\NormalTok{,}
\NormalTok{    margin}\OperatorTok{=}\BuiltInTok{dict}\NormalTok{(t}\OperatorTok{=}\DecValTok{0}\NormalTok{, b}\OperatorTok{=}\DecValTok{0}\NormalTok{, l}\OperatorTok{=}\DecValTok{0}\NormalTok{, r}\OperatorTok{=}\DecValTok{0}\NormalTok{),}
\NormalTok{    template}\OperatorTok{=}\StringTok{"plotly\_white"}\NormalTok{,}
\NormalTok{    hovermode}\OperatorTok{=}\VariableTok{False}\NormalTok{,}
\NormalTok{)}


\NormalTok{fig.update\_xaxes(title\_text}\OperatorTok{=}\StringTok{""}\NormalTok{, }\BuiltInTok{range}\OperatorTok{=}\NormalTok{[}\DecValTok{0}\NormalTok{, }\DecValTok{10}\NormalTok{], row}\OperatorTok{=}\DecValTok{1}\NormalTok{, col}\OperatorTok{=}\DecValTok{1}\NormalTok{)}
\NormalTok{fig.update\_xaxes(title\_text}\OperatorTok{=}\StringTok{"time (s)"}\NormalTok{, }\BuiltInTok{range}\OperatorTok{=}\NormalTok{[}\DecValTok{0}\NormalTok{, }\DecValTok{10}\NormalTok{], row}\OperatorTok{=}\DecValTok{2}\NormalTok{, col}\OperatorTok{=}\DecValTok{1}\NormalTok{)}
\NormalTok{fig.update\_yaxes(title\_text}\OperatorTok{=}\StringTok{"current"}\NormalTok{, }\BuiltInTok{range}\OperatorTok{=}\NormalTok{[}\DecValTok{0}\NormalTok{, }\FloatTok{0.25}\NormalTok{], row}\OperatorTok{=}\DecValTok{1}\NormalTok{, col}\OperatorTok{=}\DecValTok{1}\NormalTok{)}
\NormalTok{fig.update\_yaxes(title\_text}\OperatorTok{=}\StringTok{"rate"}\NormalTok{, }\BuiltInTok{range}\OperatorTok{=}\NormalTok{[}\DecValTok{0}\NormalTok{, }\DecValTok{1}\NormalTok{], row}\OperatorTok{=}\DecValTok{2}\NormalTok{, col}\OperatorTok{=}\DecValTok{1}\NormalTok{)}
\NormalTok{fig.update\_xaxes(title\_text}\OperatorTok{=}\StringTok{"rate 1"}\NormalTok{, }\BuiltInTok{range}\OperatorTok{=}\NormalTok{[}\DecValTok{0}\NormalTok{, }\DecValTok{1}\NormalTok{], row}\OperatorTok{=}\DecValTok{1}\NormalTok{, col}\OperatorTok{=}\DecValTok{2}\NormalTok{)}
\NormalTok{fig.update\_yaxes(title\_text}\OperatorTok{=}\StringTok{"rate 2"}\NormalTok{, }\BuiltInTok{range}\OperatorTok{=}\NormalTok{[}\DecValTok{0}\NormalTok{, }\DecValTok{1}\NormalTok{], row}\OperatorTok{=}\DecValTok{1}\NormalTok{, col}\OperatorTok{=}\DecValTok{2}\NormalTok{)}
\NormalTok{fig.update\_scenes(xaxis\_title\_text}\OperatorTok{=}\StringTok{\textquotesingle{}rate 1\textquotesingle{}}\NormalTok{,  }
\NormalTok{                  yaxis\_title\_text}\OperatorTok{=}\StringTok{\textquotesingle{}rate 2\textquotesingle{}}\NormalTok{, row}\OperatorTok{=}\DecValTok{1}\NormalTok{, col}\OperatorTok{=}\DecValTok{2}\NormalTok{)}


\NormalTok{config }\OperatorTok{=}\NormalTok{ \{}\StringTok{\textquotesingle{}displayModeBar\textquotesingle{}}\NormalTok{: }\VariableTok{False}\NormalTok{\}}

\NormalTok{fig.show(config}\OperatorTok{=}\NormalTok{config)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
/tmp/ipykernel_563129/2187511751.py:3: RuntimeWarning:

divide by zero encountered in arctanh

/tmp/ipykernel_563129/2187511751.py:3: RuntimeWarning:

divide by zero encountered in log

/tmp/ipykernel_563129/2187511751.py:3: RuntimeWarning:

invalid value encountered in scalar add
\end{verbatim}

\begin{verbatim}
Unable to display output for mime type(s): application/vnd.plotly.v1+json, text/html
\end{verbatim}

\hypertarget{experimental-data}{%
\subsection{Experimental data}\label{experimental-data}}

\begin{figure}

{\centering \includegraphics[width=6.25in,height=\textheight]{figs/roitman1.png}

}

\end{figure}

\begin{figure}

{\centering \includegraphics[width=3.125in,height=\textheight]{figs/roitman23.png}

}

\end{figure}

\href{https://doi.org/10.1523/JNEUROSCI.22-21-09475.2002}{Roitman and
Shadlen 2002}

\hypertarget{experimental-data-1}{%
\subsection{Experimental data}\label{experimental-data-1}}

\includegraphics{figs/2025-12-03-16-58-17.png}

\href{https://doi.org/10.1038/s41586-025-09528-4}{Luo et al.~2025}

\hypertarget{continuous-spatial-memory}{%
\subsection{Continuous spatial memory}\label{continuous-spatial-memory}}

\includegraphics{figs/ODR.png}

\includegraphics{figs/funahashi.png}

\href{https://doi.org/10.1152/jn.1989.61.2.331}{Funahashi et al 1989}

\hypertarget{ring-attractor-model}{%
\subsection{Ring attractor model}\label{ring-attractor-model}}

\includegraphics{attractors_part2_files/mediabag/figs/ring.pdf}

\begin{eqnarray*}

\newcommand{\blue}[1]{\color{blue}{#1}}
\newcommand{\red}[1]{\color{red}{#1}}

\scriptstyle \tau_E \frac{d r^E_i(t)}{dt} &=& \scriptstyle -r^E_i(t) + F_E\left[ \sum_j \red{W^{EE}}_{ij} r^E_j(t) - \blue{W^{EI}} r^I(t) \right] \\

\scriptstyle \tau_I \frac{d r^I(t)}{dt} &=& \scriptstyle -r^I(t) + F_I\left[ \red{W^{IE}} \sum_j r^E_j(t) - \blue{W^{II}} r^I(t) \right] \\

\scriptstyle W^{EE}_{ij} &=& \scriptstyle J_E \cos(\theta_i - \theta_j)

\end{eqnarray*}

\begin{figure}

{\centering \includegraphics[width=1.04167in,height=\textheight]{attractors_part2_files/mediabag/figs/go-down.pdf}

}

\end{figure}

\begin{eqnarray*}

\newcommand{\blue}[1]{\color{blue}{#1}}
\newcommand{\red}[1]{\color{red}{#1}}

\scriptstyle \tau \frac{d r_i(t)}{dt} &=& \scriptstyle -r_i(t) + F\left[ \sum_j J_{ij} r_j(t) \right] \\

\scriptstyle J_{ij} &=& \scriptstyle \red{J_E} \cos(\theta_i - \theta_j) - \blue{\frac{\gamma W^{EI}W^{IE}}{1+\gamma W^{II}}}

\end{eqnarray*}

\hypertarget{ring-attractor-network}{%
\subsection{Ring attractor network}\label{ring-attractor-network}}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{Nn }\OperatorTok{=} \DecValTok{256}
\NormalTok{x}\OperatorTok{=}\NormalTok{ np.linspace(}\OperatorTok{{-}}\NormalTok{np.pi, np.pi, Nn, endpoint}\OperatorTok{=}\VariableTok{False}\NormalTok{)}

\NormalTok{cs }\OperatorTok{=}\NormalTok{ np.cos(x)}
\NormalTok{sn }\OperatorTok{=}\NormalTok{ np.sin(x)}

\NormalTok{J0 }\OperatorTok{=} \OperatorTok{{-}}\FloatTok{3.2}
\NormalTok{J2 }\OperatorTok{=} \FloatTok{8.5}
\NormalTok{JE }\OperatorTok{=}\NormalTok{ J0 }\OperatorTok{+}\NormalTok{ J2}\OperatorTok{*}\NormalTok{ (np.outer(cs,cs) }\OperatorTok{+}\NormalTok{ np.outer(sn, sn))}


\NormalTok{dt}\OperatorTok{=}\FloatTok{0.01}
\NormalTok{T}\OperatorTok{=}\DecValTok{5}
\NormalTok{time }\OperatorTok{=}\NormalTok{ np.arange(}\DecValTok{0}\NormalTok{,T,dt)}
\NormalTok{Nt }\OperatorTok{=} \BuiltInTok{len}\NormalTok{(time)}

\CommentTok{\# input{-}output function for all cells, as used previously (Brunel, Cereb Cortex 13:1151, 2003)}
\KeywordTok{def}\NormalTok{ fI(x):}
    \ControlFlowTok{return}\NormalTok{ x}\OperatorTok{*}\NormalTok{x}\OperatorTok{*}\NormalTok{(x}\OperatorTok{\textgreater{}}\DecValTok{0}\NormalTok{)}\OperatorTok{*}\NormalTok{(x}\OperatorTok{\textless{}}\DecValTok{1}\NormalTok{) }\OperatorTok{+}\NormalTok{ np.sqrt(np.}\BuiltInTok{abs}\NormalTok{(}\DecValTok{4}\OperatorTok{*}\NormalTok{x}\OperatorTok{{-}}\DecValTok{3}\NormalTok{))}\OperatorTok{*}\NormalTok{(x}\OperatorTok{\textgreater{}=}\DecValTok{1}\NormalTok{)}

\BuiltInTok{input} \OperatorTok{=}\NormalTok{ np.zeros((Nt,))}
\BuiltInTok{input}\NormalTok{[}\BuiltInTok{int}\NormalTok{(}\FloatTok{1.}\OperatorTok{/}\NormalTok{dt):}\BuiltInTok{int}\NormalTok{(}\FloatTok{1.5}\OperatorTok{/}\NormalTok{dt)] }\OperatorTok{=} \DecValTok{1}

\NormalTok{tau }\OperatorTok{=} \FloatTok{0.1}

\CommentTok{\# routine to extract population vectors from matrix of rates}
\NormalTok{vecs }\OperatorTok{=}\NormalTok{ np.cos(x) }\OperatorTok{+} \OtherTok{1j}\OperatorTok{*}\NormalTok{np.sin(x)}
\NormalTok{vecs }\OperatorTok{=}\NormalTok{ np.outer(np.ones((}\DecValTok{1}\NormalTok{,Nt)),vecs)}
\KeywordTok{def}\NormalTok{ decode(rate):}
\NormalTok{    res }\OperatorTok{=}\NormalTok{ np.}\BuiltInTok{sum}\NormalTok{(vecs}\OperatorTok{*}\NormalTok{rate, axis}\OperatorTok{=}\DecValTok{1}\NormalTok{)}
    \ControlFlowTok{return}\NormalTok{ np.angle(res)}
    
\KeywordTok{def}\NormalTok{ get\_traces(stimat):}

\NormalTok{    I }\OperatorTok{=}\NormalTok{ np.exp(}\DecValTok{4}\OperatorTok{*}\NormalTok{np.cos(x }\OperatorTok{{-}}\NormalTok{ stimat))}
    \CommentTok{\#I = 4*(1 {-} 0.1 + 0.1 * np.cos(x {-} stimat)) \# stimulus current}
\NormalTok{    rate }\OperatorTok{=}\NormalTok{ np.zeros((Nt,Nn))}

    \ControlFlowTok{for}\NormalTok{ i }\KeywordTok{in} \BuiltInTok{range}\NormalTok{(Nt}\OperatorTok{{-}}\DecValTok{1}\NormalTok{): }
\NormalTok{        network\_inputs }\OperatorTok{=}\NormalTok{ np.dot(JE, rate[i])}\OperatorTok{/}\NormalTok{Nn}
\NormalTok{        noise }\OperatorTok{=} \FloatTok{0.3}\OperatorTok{*}\NormalTok{np.random.randn(Nn,}\DecValTok{1}\NormalTok{).flatten()}
\NormalTok{        rate[i}\OperatorTok{+}\DecValTok{1}\NormalTok{] }\OperatorTok{=}\NormalTok{ rate[i] }\OperatorTok{+}\NormalTok{ dt}\OperatorTok{/}\NormalTok{tau }\OperatorTok{*}\NormalTok{ (}\OperatorTok{{-}}\NormalTok{rate[i] }\OperatorTok{+}\NormalTok{ fI(network\_inputs }\OperatorTok{+}\NormalTok{  noise }\OperatorTok{+} \BuiltInTok{input}\NormalTok{[i]}\OperatorTok{*}\NormalTok{I))}
        
    \ControlFlowTok{return}\NormalTok{ rate}

\CommentTok{\# Add traces, one for each slider step}

\NormalTok{frames }\OperatorTok{=}\NormalTok{ []}
\NormalTok{stims }\OperatorTok{=}\NormalTok{ np.random.randint(}\OperatorTok{{-}}\DecValTok{180}\NormalTok{, }\DecValTok{180}\NormalTok{, }\DecValTok{20}\NormalTok{)}

\ControlFlowTok{for}\NormalTok{ step, stimat }\KeywordTok{in} \BuiltInTok{enumerate}\NormalTok{(stims):}

\NormalTok{    fig }\OperatorTok{=}\NormalTok{ make\_subplots(rows}\OperatorTok{=}\DecValTok{2}\NormalTok{, cols}\OperatorTok{=}\DecValTok{3}\NormalTok{,}
\NormalTok{      specs}\OperatorTok{=}\NormalTok{[[\{}\StringTok{\textquotesingle{}rowspan\textquotesingle{}}\NormalTok{: }\DecValTok{1}\NormalTok{, }\StringTok{\textquotesingle{}colspan\textquotesingle{}}\NormalTok{: }\DecValTok{2}\NormalTok{\}, }\VariableTok{None}\NormalTok{, \{}\StringTok{\textquotesingle{}rowspan\textquotesingle{}}\NormalTok{: }\DecValTok{2}\NormalTok{, }\StringTok{\textquotesingle{}colspan\textquotesingle{}}\NormalTok{: }\DecValTok{1}\NormalTok{\}],}
\NormalTok{       [\{}\StringTok{\textquotesingle{}rowspan\textquotesingle{}}\NormalTok{: }\DecValTok{1}\NormalTok{, }\StringTok{\textquotesingle{}colspan\textquotesingle{}}\NormalTok{: }\DecValTok{2}\NormalTok{\}, }\VariableTok{None}\NormalTok{, }\VariableTok{None}\NormalTok{]], }
\NormalTok{      row\_heights}\OperatorTok{=}\NormalTok{[}\FloatTok{0.3}\NormalTok{, }\FloatTok{0.7}\NormalTok{],}
\CommentTok{\#print\_grid=False,}
\NormalTok{      vertical\_spacing}\OperatorTok{=}\FloatTok{0.12}\NormalTok{,}
\NormalTok{      horizontal\_spacing}\OperatorTok{=}\FloatTok{0.09}\NormalTok{)}
    
\NormalTok{    rate }\OperatorTok{=}\NormalTok{ get\_traces(np.deg2rad(stimat))}
\NormalTok{    enc }\OperatorTok{=}\NormalTok{ decode(rate)}

\NormalTok{    fig.add\_trace(}
\NormalTok{        go.Scatter(}
\NormalTok{            visible}\OperatorTok{=}\VariableTok{True}\NormalTok{,}
\NormalTok{            line}\OperatorTok{=}\BuiltInTok{dict}\NormalTok{(color}\OperatorTok{=}\StringTok{"\#000000"}\NormalTok{, width}\OperatorTok{=}\DecValTok{4}\NormalTok{),}
\NormalTok{            name}\OperatorTok{=}\StringTok{""}\NormalTok{,}
\NormalTok{            x }\OperatorTok{=}\NormalTok{ time,}
\NormalTok{            y }\OperatorTok{=} \BuiltInTok{input}\NormalTok{,}
\NormalTok{            showlegend }\OperatorTok{=} \VariableTok{False}\NormalTok{),}
\NormalTok{            row }\OperatorTok{=} \DecValTok{1}\NormalTok{, col }\OperatorTok{=} \DecValTok{1}\NormalTok{)}
            
\NormalTok{    fig.add\_trace(go.Heatmap(z}\OperatorTok{=}\NormalTok{rate.T, }
\NormalTok{        x}\OperatorTok{=}\NormalTok{time, }
\NormalTok{        y}\OperatorTok{=}\NormalTok{np.rad2deg(x), }
\NormalTok{        zmin}\OperatorTok{=}\DecValTok{0}\NormalTok{, }
\NormalTok{        zmax}\OperatorTok{=}\DecValTok{7}\NormalTok{, }
\NormalTok{        zauto}\OperatorTok{=}\VariableTok{False}\NormalTok{,}
\NormalTok{        colorscale}\OperatorTok{=}\NormalTok{colorscale,}
\NormalTok{        showscale}\OperatorTok{=}\VariableTok{False}\NormalTok{), row}\OperatorTok{=}\DecValTok{2}\NormalTok{, col}\OperatorTok{=}\DecValTok{1}\NormalTok{)}
        
\NormalTok{    fig.add\_trace(go.Scatter(mode}\OperatorTok{=}\StringTok{"markers"}\NormalTok{,}
\NormalTok{            x}\OperatorTok{=}\NormalTok{[}\FloatTok{1.}\NormalTok{], }
\NormalTok{        y}\OperatorTok{=}\NormalTok{[stimat],}
\NormalTok{        marker\_symbol}\OperatorTok{=}\StringTok{"arrow{-}right"}\NormalTok{,}
\NormalTok{        marker\_color}\OperatorTok{=}\StringTok{"red"}\NormalTok{,}
\NormalTok{        marker\_size}\OperatorTok{=}\DecValTok{15}\NormalTok{,}
\NormalTok{        showlegend }\OperatorTok{=} \VariableTok{False}\NormalTok{), row}\OperatorTok{=}\DecValTok{2}\NormalTok{, col}\OperatorTok{=}\DecValTok{1}\NormalTok{)}
        
\NormalTok{    fig.add\_trace(}
\NormalTok{        go.Scatter(}
\NormalTok{            visible}\OperatorTok{=}\VariableTok{True}\NormalTok{,}
\NormalTok{            line}\OperatorTok{=}\BuiltInTok{dict}\NormalTok{(color}\OperatorTok{=}\StringTok{"magenta"}\NormalTok{, width}\OperatorTok{=}\DecValTok{2}\NormalTok{),}
\NormalTok{            name}\OperatorTok{=}\StringTok{""}\NormalTok{,}
\NormalTok{            x }\OperatorTok{=}\NormalTok{ time,}
\NormalTok{            y }\OperatorTok{=}\NormalTok{ np.rad2deg(enc),}
\NormalTok{            showlegend }\OperatorTok{=} \VariableTok{False}\NormalTok{),}
\NormalTok{            row }\OperatorTok{=} \DecValTok{2}\NormalTok{, col }\OperatorTok{=} \DecValTok{1}\NormalTok{)}

\NormalTok{    fig.add\_trace(}
\NormalTok{        go.Scatter(}
\NormalTok{            visible}\OperatorTok{=}\VariableTok{True}\NormalTok{,}
\NormalTok{            line}\OperatorTok{=}\BuiltInTok{dict}\NormalTok{(color}\OperatorTok{=}\StringTok{"\#000000"}\NormalTok{, width}\OperatorTok{=}\DecValTok{1}\NormalTok{),}
\NormalTok{            name}\OperatorTok{=}\StringTok{""}\NormalTok{,}
\NormalTok{            x }\OperatorTok{=}\NormalTok{ np.rad2deg(x),}
\NormalTok{            y }\OperatorTok{=}\NormalTok{ rate[}\OperatorTok{{-}}\DecValTok{1}\NormalTok{],}
\NormalTok{            showlegend }\OperatorTok{=} \VariableTok{False}\NormalTok{),}
\NormalTok{            row }\OperatorTok{=} \DecValTok{1}\NormalTok{, col }\OperatorTok{=} \DecValTok{3}\NormalTok{)}
            
\NormalTok{    fig.add\_trace(}
\NormalTok{        go.Scatter(mode}\OperatorTok{=}\StringTok{"markers"}\NormalTok{,}
\NormalTok{            x}\OperatorTok{=}\NormalTok{[stimat], }
\NormalTok{        y}\OperatorTok{=}\NormalTok{[}\FloatTok{5.}\NormalTok{],}
\NormalTok{        marker\_symbol}\OperatorTok{=}\StringTok{"arrow{-}down"}\NormalTok{,}
\NormalTok{        marker\_color}\OperatorTok{=}\StringTok{"red"}\NormalTok{,}
\NormalTok{        marker\_size}\OperatorTok{=}\DecValTok{15}\NormalTok{,}
\NormalTok{        showlegend }\OperatorTok{=} \VariableTok{False}\NormalTok{),}
\NormalTok{            row }\OperatorTok{=} \DecValTok{1}\NormalTok{, col }\OperatorTok{=} \DecValTok{3}\NormalTok{)}
            
\NormalTok{    fig.add\_trace(}
\NormalTok{        go.Scatter(mode}\OperatorTok{=}\StringTok{"markers"}\NormalTok{,}
\NormalTok{            x}\OperatorTok{=}\NormalTok{[np.rad2deg(enc[}\OperatorTok{{-}}\DecValTok{1}\NormalTok{])], }
\NormalTok{        y}\OperatorTok{=}\NormalTok{[}\FloatTok{5.5}\NormalTok{],}
\NormalTok{        marker\_symbol}\OperatorTok{=}\StringTok{"arrow{-}down"}\NormalTok{,}
\NormalTok{        marker\_color}\OperatorTok{=}\StringTok{"magenta"}\NormalTok{,}
\NormalTok{        marker\_size}\OperatorTok{=}\DecValTok{15}\NormalTok{,}
\NormalTok{        showlegend }\OperatorTok{=} \VariableTok{False}\NormalTok{),}
\NormalTok{            row }\OperatorTok{=} \DecValTok{1}\NormalTok{, col }\OperatorTok{=} \DecValTok{3}\NormalTok{)}

\NormalTok{    fig.update\_xaxes(title\_text}\OperatorTok{=}\StringTok{""}\NormalTok{, }\BuiltInTok{range}\OperatorTok{=}\NormalTok{[}\DecValTok{0}\NormalTok{, T], row}\OperatorTok{=}\DecValTok{1}\NormalTok{, col}\OperatorTok{=}\DecValTok{1}\NormalTok{)}
\NormalTok{    fig.update\_xaxes(title\_text}\OperatorTok{=}\StringTok{"time (s)"}\NormalTok{, }\BuiltInTok{range}\OperatorTok{=}\NormalTok{[}\DecValTok{0}\NormalTok{, T], row}\OperatorTok{=}\DecValTok{2}\NormalTok{, col}\OperatorTok{=}\DecValTok{1}\NormalTok{)}
\NormalTok{    fig.update\_yaxes(title\_text}\OperatorTok{=}\StringTok{"current"}\NormalTok{, row}\OperatorTok{=}\DecValTok{1}\NormalTok{, col}\OperatorTok{=}\DecValTok{1}\NormalTok{)}
\NormalTok{    fig.update\_yaxes(title\_text}\OperatorTok{=}\StringTok{"neurons (deg)"}\NormalTok{, }\BuiltInTok{range}\OperatorTok{=}\NormalTok{[}\OperatorTok{{-}}\DecValTok{180}\NormalTok{, }\DecValTok{180}\NormalTok{], row}\OperatorTok{=}\DecValTok{2}\NormalTok{, col}\OperatorTok{=}\DecValTok{1}\NormalTok{)}
\NormalTok{    fig.update\_xaxes(title\_text}\OperatorTok{=}\StringTok{"neurons (deg)"}\NormalTok{, }\BuiltInTok{range}\OperatorTok{=}\NormalTok{[}\OperatorTok{{-}}\DecValTok{180}\NormalTok{, }\DecValTok{180}\NormalTok{], row}\OperatorTok{=}\DecValTok{1}\NormalTok{, col}\OperatorTok{=}\DecValTok{3}\NormalTok{)}
\NormalTok{    fig.update\_yaxes(title\_text}\OperatorTok{=}\StringTok{"rate"}\NormalTok{, row}\OperatorTok{=}\DecValTok{1}\NormalTok{, col}\OperatorTok{=}\DecValTok{3}\NormalTok{)}

\NormalTok{    frames }\OperatorTok{+=}\NormalTok{ [go.Frame(data}\OperatorTok{=}\NormalTok{fig.data, layout}\OperatorTok{=}\NormalTok{fig.layout, name}\OperatorTok{=}\BuiltInTok{str}\NormalTok{(step))]}

    \CommentTok{\#\# store the first frame to reuse later}
    \ControlFlowTok{if}\NormalTok{ step }\OperatorTok{==} \DecValTok{0}\NormalTok{:}
\NormalTok{        first\_fig }\OperatorTok{=}\NormalTok{ fig}
        
\NormalTok{fig }\OperatorTok{=}\NormalTok{ go.Figure(frames}\OperatorTok{=}\NormalTok{frames)}

\CommentTok{\#\# add the first frame to the figure so it shows up initially}
\NormalTok{fig.add\_traces(first\_fig.data,)}
\NormalTok{fig.layout }\OperatorTok{=}\NormalTok{ first\_fig.layout}

\CommentTok{\#\# the rest is coped from the plotly documentation example on mri volume slices}
\KeywordTok{def}\NormalTok{ frame\_args(duration):}
    \ControlFlowTok{return}\NormalTok{ \{}
            \StringTok{"frame"}\NormalTok{: \{}\StringTok{"duration"}\NormalTok{: duration\},}
            \StringTok{"mode"}\NormalTok{: }\StringTok{"immediate"}\NormalTok{,}
            \StringTok{"fromcurrent"}\NormalTok{: }\VariableTok{True}\NormalTok{,}
            \StringTok{"transition"}\NormalTok{: \{}\StringTok{"duration"}\NormalTok{: }\DecValTok{0}\NormalTok{, }\StringTok{"easing"}\NormalTok{: }\StringTok{"linear"}\NormalTok{\},}
\NormalTok{        \}}

\NormalTok{sliders }\OperatorTok{=}\NormalTok{ [}
\NormalTok{            \{}
                \StringTok{"pad"}\NormalTok{: \{}\StringTok{"b"}\NormalTok{: }\DecValTok{10}\NormalTok{, }\StringTok{"t"}\NormalTok{: }\DecValTok{60}\NormalTok{\},}
                \StringTok{"len"}\NormalTok{: }\FloatTok{0.9}\NormalTok{,}
                \StringTok{"x"}\NormalTok{: }\FloatTok{0.1}\NormalTok{,}
                \StringTok{"y"}\NormalTok{: }\DecValTok{0}\NormalTok{,}
                \StringTok{"steps"}\NormalTok{: [}
\NormalTok{                    \{}
                        \StringTok{"args"}\NormalTok{: [[f.name], frame\_args(}\DecValTok{2000}\NormalTok{)],}
                        \StringTok{"label"}\NormalTok{: }\BuiltInTok{str}\NormalTok{(k),}
                        \StringTok{"method"}\NormalTok{: }\StringTok{"animate"}\NormalTok{,}
\NormalTok{                    \}}
                    \ControlFlowTok{for}\NormalTok{ k, f }\KeywordTok{in} \BuiltInTok{enumerate}\NormalTok{(fig.frames)}
\NormalTok{                ],}
\NormalTok{            \}}
\NormalTok{        ]}

\NormalTok{fig.update\_layout(}
\NormalTok{         title}\OperatorTok{=}\StringTok{\textquotesingle{}\textquotesingle{}}\NormalTok{,}
\NormalTok{         width}\OperatorTok{=}\DecValTok{1000}\NormalTok{,}
\NormalTok{         height}\OperatorTok{=}\DecValTok{500}\NormalTok{,}
\NormalTok{         autosize}\OperatorTok{=}\VariableTok{False}\NormalTok{,}
\NormalTok{         margin}\OperatorTok{=}\BuiltInTok{dict}\NormalTok{(t}\OperatorTok{=}\DecValTok{0}\NormalTok{, b}\OperatorTok{=}\DecValTok{0}\NormalTok{, l}\OperatorTok{=}\DecValTok{0}\NormalTok{, r}\OperatorTok{=}\DecValTok{0}\NormalTok{),}
\NormalTok{         hovermode}\OperatorTok{=}\VariableTok{False}\NormalTok{,}
\NormalTok{         updatemenus }\OperatorTok{=}\NormalTok{ [}
\NormalTok{            \{}
                \StringTok{"buttons"}\NormalTok{: [}
\NormalTok{                    \{}
                        \StringTok{"args"}\NormalTok{: [}\VariableTok{None}\NormalTok{, frame\_args(}\DecValTok{2000}\NormalTok{)],}
                        \StringTok{"label"}\NormalTok{: }\StringTok{"\&\#9654;"}\NormalTok{, }\CommentTok{\# play symbol}
                        \StringTok{"method"}\NormalTok{: }\StringTok{"animate"}\NormalTok{,}
\NormalTok{                    \},}
\NormalTok{                    \{}
                        \StringTok{"args"}\NormalTok{: [[}\VariableTok{None}\NormalTok{], frame\_args(}\DecValTok{2000}\NormalTok{)],}
                        \StringTok{"label"}\NormalTok{: }\StringTok{"\&\#9724;"}\NormalTok{, }\CommentTok{\# pause symbol}
                        \StringTok{"method"}\NormalTok{: }\StringTok{"animate"}\NormalTok{,}
\NormalTok{                    \},}
\NormalTok{                ],}
                \StringTok{"direction"}\NormalTok{: }\StringTok{"left"}\NormalTok{,}
                \StringTok{"pad"}\NormalTok{: \{}\StringTok{"r"}\NormalTok{: }\DecValTok{10}\NormalTok{, }\StringTok{"t"}\NormalTok{: }\DecValTok{70}\NormalTok{\},}
                \StringTok{"type"}\NormalTok{: }\StringTok{"buttons"}\NormalTok{,}
                \StringTok{"x"}\NormalTok{: }\FloatTok{0.1}\NormalTok{,}
                \StringTok{"y"}\NormalTok{: }\DecValTok{0}\NormalTok{,}
\NormalTok{            \}}
\NormalTok{         ],}
\NormalTok{         sliders}\OperatorTok{=}\NormalTok{sliders}
\NormalTok{)}


\NormalTok{config }\OperatorTok{=}\NormalTok{ \{}\StringTok{\textquotesingle{}displayModeBar\textquotesingle{}}\NormalTok{: }\VariableTok{False}\NormalTok{\}}

\NormalTok{fig.show(config}\OperatorTok{=}\NormalTok{config)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
Unable to display output for mime type(s): application/vnd.plotly.v1+json, text/html
\end{verbatim}

\hypertarget{ring-attractor-model-1}{%
\subsection{Ring attractor model}\label{ring-attractor-model-1}}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{nsims}\OperatorTok{=}\DecValTok{100}
\NormalTok{dt}\OperatorTok{=}\FloatTok{0.01}
\NormalTok{time }\OperatorTok{=}\NormalTok{ np.arange(}\DecValTok{0}\NormalTok{,T,dt)}
\NormalTok{Nt }\OperatorTok{=} \BuiltInTok{len}\NormalTok{(time)}
\NormalTok{x}\OperatorTok{=}\NormalTok{ np.linspace(}\OperatorTok{{-}}\NormalTok{np.pi, np.pi, Nn, endpoint}\OperatorTok{=}\VariableTok{False}\NormalTok{)}

\NormalTok{endpoints }\OperatorTok{=}\NormalTok{ np.zeros((nsims,))}

\CommentTok{\# run the simulation multiple times}
\ControlFlowTok{for}\NormalTok{ n }\KeywordTok{in} \BuiltInTok{range}\NormalTok{(nsims):}

\NormalTok{    phase }\OperatorTok{=} \DecValTok{2}\OperatorTok{*}\NormalTok{np.pi}\OperatorTok{*}\NormalTok{np.random.rand()}
\NormalTok{    I }\OperatorTok{=} \DecValTok{2}\OperatorTok{*}\NormalTok{np.exp(}\DecValTok{4}\OperatorTok{*}\NormalTok{np.cos(x }\OperatorTok{{-}}\NormalTok{ phase))}

\NormalTok{    rate }\OperatorTok{=}\NormalTok{ np.zeros((Nt,Nn))}

\NormalTok{    tau }\OperatorTok{=} \FloatTok{0.1}

    \ControlFlowTok{for}\NormalTok{ i }\KeywordTok{in} \BuiltInTok{range}\NormalTok{(Nt}\OperatorTok{{-}}\DecValTok{1}\NormalTok{):}
        \ControlFlowTok{if}\NormalTok{ (i}\OperatorTok{\textgreater{}}\DecValTok{100}\NormalTok{)}\OperatorTok{\&}\NormalTok{(i}\OperatorTok{\textless{}}\DecValTok{150}\NormalTok{):  }
            \BuiltInTok{input}\OperatorTok{=}\NormalTok{I}
        \ControlFlowTok{else}\NormalTok{:}
            \BuiltInTok{input}\OperatorTok{=}\DecValTok{0}
\NormalTok{        network\_inputs }\OperatorTok{=}\NormalTok{ np.dot(JE, rate[i])}\OperatorTok{/}\NormalTok{Nn}
\NormalTok{        noise }\OperatorTok{=} \FloatTok{0.3}\OperatorTok{*}\NormalTok{np.random.randn(Nn,}\DecValTok{1}\NormalTok{).flatten()}
\NormalTok{        rate[i}\OperatorTok{+}\DecValTok{1}\NormalTok{] }\OperatorTok{=}\NormalTok{ rate[i] }\OperatorTok{+}\NormalTok{ dt}\OperatorTok{/}\NormalTok{tau }\OperatorTok{*}\NormalTok{ (}\OperatorTok{{-}}\NormalTok{rate[i] }\OperatorTok{+}\NormalTok{ fI(network\_inputs }\OperatorTok{+} \BuiltInTok{input} \OperatorTok{+}\NormalTok{ noise))}
    
\NormalTok{    trace }\OperatorTok{=}\NormalTok{ decode(rate)}

\NormalTok{    plt.plot(time, np.rad2deg(trace))}

\NormalTok{    endpoints[n] }\OperatorTok{=}\NormalTok{ trace[}\OperatorTok{{-}}\DecValTok{1}\NormalTok{]}

\NormalTok{plt.ylim([}\OperatorTok{{-}}\DecValTok{180}\NormalTok{, }\DecValTok{180}\NormalTok{])}
\NormalTok{plt.xlabel(}\StringTok{\textquotesingle{}time (s)\textquotesingle{}}\NormalTok{)}
\NormalTok{plt.ylabel(}\StringTok{\textquotesingle{}neuron (deg)\textquotesingle{}}\NormalTok{)}\OperatorTok{;}
\end{Highlighting}
\end{Shaded}

\begin{figure}[H]

{\centering \includegraphics{attractors_part2_files/figure-pdf/cell-10-output-1.pdf}

}

\end{figure}

\hypertarget{ring-attractor-model-2}{%
\subsection{Ring attractor model}\label{ring-attractor-model-2}}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{nsims}\OperatorTok{=}\DecValTok{100}
\NormalTok{dt}\OperatorTok{=}\FloatTok{0.01}
\NormalTok{time }\OperatorTok{=}\NormalTok{ np.arange(}\DecValTok{0}\NormalTok{,T,dt)}
\NormalTok{Nt }\OperatorTok{=} \BuiltInTok{len}\NormalTok{(time)}


\NormalTok{endpoints }\OperatorTok{=}\NormalTok{ np.zeros((nsims,))}

\CommentTok{\# run the simulation multiple times}
\ControlFlowTok{for}\NormalTok{ n }\KeywordTok{in} \BuiltInTok{range}\NormalTok{(nsims):}

\NormalTok{    I }\OperatorTok{=} \DecValTok{2}\OperatorTok{*}\NormalTok{np.exp(}\DecValTok{4}\OperatorTok{*}\NormalTok{np.cos(x))}

\NormalTok{    rate }\OperatorTok{=}\NormalTok{ np.zeros((Nt,Nn))}

\NormalTok{    tau }\OperatorTok{=} \FloatTok{0.1}

    \ControlFlowTok{for}\NormalTok{ i }\KeywordTok{in} \BuiltInTok{range}\NormalTok{(Nt}\OperatorTok{{-}}\DecValTok{1}\NormalTok{):}
        \ControlFlowTok{if}\NormalTok{ (i}\OperatorTok{\textgreater{}}\DecValTok{100}\NormalTok{)}\OperatorTok{\&}\NormalTok{(i}\OperatorTok{\textless{}}\DecValTok{150}\NormalTok{):  }
            \BuiltInTok{input}\OperatorTok{=}\NormalTok{I}
        \ControlFlowTok{else}\NormalTok{:}
            \BuiltInTok{input}\OperatorTok{=}\DecValTok{0}
\NormalTok{        network\_inputs }\OperatorTok{=}\NormalTok{ np.dot(JE, rate[i])}\OperatorTok{/}\NormalTok{Nn}
\NormalTok{        noise }\OperatorTok{=} \FloatTok{0.3}\OperatorTok{*}\NormalTok{np.random.randn(Nn,}\DecValTok{1}\NormalTok{).flatten()}
\NormalTok{        rate[i}\OperatorTok{+}\DecValTok{1}\NormalTok{] }\OperatorTok{=}\NormalTok{ rate[i] }\OperatorTok{+}\NormalTok{ dt}\OperatorTok{/}\NormalTok{tau }\OperatorTok{*}\NormalTok{ (}\OperatorTok{{-}}\NormalTok{rate[i] }\OperatorTok{+}\NormalTok{ fI(network\_inputs }\OperatorTok{+} \BuiltInTok{input} \OperatorTok{+}\NormalTok{ noise))}
    
\NormalTok{    trace }\OperatorTok{=}\NormalTok{ decode(rate)}

\NormalTok{    plt.plot(time, np.rad2deg(trace))}

\NormalTok{    endpoints[n] }\OperatorTok{=}\NormalTok{ trace[}\OperatorTok{{-}}\DecValTok{1}\NormalTok{]}

\NormalTok{plt.ylim([}\OperatorTok{{-}}\DecValTok{20}\NormalTok{, }\DecValTok{20}\NormalTok{])}
\NormalTok{plt.xlabel(}\StringTok{\textquotesingle{}time (s)\textquotesingle{}}\NormalTok{)}
\NormalTok{plt.ylabel(}\StringTok{\textquotesingle{}neuron (deg)\textquotesingle{}}\NormalTok{)}\OperatorTok{;}
\end{Highlighting}
\end{Shaded}

\begin{figure}[H]

{\centering \includegraphics{attractors_part2_files/figure-pdf/cell-11-output-1.pdf}

}

\end{figure}

\hypertarget{experimental-evidence}{%
\subsection{Experimental evidence}\label{experimental-evidence}}

\begin{figure}

{\centering \includegraphics[width=3.64583in,height=\textheight]{figs/wimmer.png}

}

\end{figure}

\begin{figure}

{\centering \includegraphics[width=6.25in,height=\textheight]{figs/tschiersch.png}

}

\end{figure}

\href{https://doi.org/10.1038/nn.3645}{Wimmer et al 2014}

\href{https://doi.org/10.1101/2025.01.15.633176}{Tschiersch et al 2025}

\hypertarget{network-models-reviewed}{%
\subsection{Network models reviewed}\label{network-models-reviewed}}

\begin{itemize}
\tightlist
\item
  E-I networks:

  \begin{itemize}
  \tightlist
  \item
    Wilson-Cowan network
  \item
    Inhibition-stabilized network
  \end{itemize}
\item
  Double well networks:

  \begin{itemize}
  \tightlist
  \item
    selective working memory
  \item
    decision making
  \end{itemize}
\item
  Ring attractor network
\end{itemize}

\hypertarget{as-an-rnn-scriptstyle-tau-fracd-i_itdt--i_it-sum_j-j_ij-fi_jt}{%
\subsection{\texorpdfstring{As an RNN:
\(\scriptstyle \tau \frac{d I_i(t)}{dt} = -I_i(t) + \sum_j J_{ij} F[I_j(t)]\)}{As an RNN: \textbackslash scriptstyle \textbackslash tau \textbackslash frac\{d I\_i(t)\}\{dt\} = -I\_i(t) + \textbackslash sum\_j J\_\{ij\} F{[}I\_j(t){]}}}\label{as-an-rnn-scriptstyle-tau-fracd-i_itdt--i_it-sum_j-j_ij-fi_jt}}

\[
\newcommand{\blue}[1]{\color{blue}{#1}}
\newcommand{\red}[1]{\color{red}{#1}}
\scriptstyle J_{ij} = \scriptstyle \red{J_E} \cos(\theta_i - \theta_j) - \blue{\frac{\gamma W^{EI}W^{IE}}{1+\gamma W^{II}}}
\]

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{plt.imshow(JE, origin}\OperatorTok{=}\StringTok{"lower"}\NormalTok{)}
\NormalTok{plt.xlabel(}\StringTok{\textquotesingle{}to neuron\textquotesingle{}}\NormalTok{)}
\NormalTok{plt.ylabel(}\StringTok{\textquotesingle{}from neuron\textquotesingle{}}\NormalTok{)}
\NormalTok{plt.colorbar(label}\OperatorTok{=}\StringTok{"connection strength"}\NormalTok{)}\OperatorTok{;}
\end{Highlighting}
\end{Shaded}

\begin{figure}[H]

{\centering \includegraphics{attractors_part2_files/figure-pdf/cell-12-output-1.pdf}

}

\end{figure}

\includegraphics[width=1.5625in,height=\textheight]{attractors_part2_files/mediabag/figs/ring.pdf}

\[
\newcommand{\blue}[1]{\color{blue}{#1}}
\newcommand{\red}[1]{\color{red}{#1}}
\scriptstyle J_{ij} = \scriptstyle \left\{
\begin{array}{ll}
      \scriptstyle \red{J_E}, & \scriptstyle C(i)=C(j) \\
      \scriptstyle \blue{J_I}, & \scriptstyle C(i) \neq C(j) \\
\end{array} 
\; \; \; \; \; \right.
\]

\begin{Shaded}
\begin{Highlighting}[]
\ImportTok{import}\NormalTok{ scipy.linalg }\ImportTok{as}\NormalTok{ linalg}
\NormalTok{a }\OperatorTok{=} \FloatTok{1.1}\OperatorTok{*}\NormalTok{np.ones((Nn}\OperatorTok{//}\DecValTok{2}\NormalTok{, Nn}\OperatorTok{//}\DecValTok{2}\NormalTok{))}
\NormalTok{Jdw }\OperatorTok{=} \OperatorTok{{-}}\FloatTok{1.8}\OperatorTok{*}\NormalTok{np.ones((Nn, Nn)) }\OperatorTok{+}\NormalTok{ linalg.block\_diag(a,a)}
\NormalTok{plt.imshow(Jdw, origin}\OperatorTok{=}\StringTok{"lower"}\NormalTok{)}
\NormalTok{plt.xlabel(}\StringTok{\textquotesingle{}to neuron\textquotesingle{}}\NormalTok{)}
\NormalTok{plt.ylabel(}\StringTok{\textquotesingle{}from neuron\textquotesingle{}}\NormalTok{)}
\NormalTok{plt.colorbar(label}\OperatorTok{=}\StringTok{"connection strength"}\NormalTok{)}\OperatorTok{;}
\end{Highlighting}
\end{Shaded}

\begin{figure}[H]

{\centering \includegraphics{attractors_part2_files/figure-pdf/cell-13-output-1.pdf}

}

\end{figure}

\includegraphics[width=2.08333in,height=\textheight]{attractors_part2_files/mediabag/figs/doublewell3.pdf}

\hypertarget{rank-1-rnn}{%
\subsection{Rank-1 RNN}\label{rank-1-rnn}}

\(\scriptstyle J_{ij} = \xi_i \xi_j\)

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{csi }\OperatorTok{=}\NormalTok{ np.random.randn(Nn)}
\NormalTok{J1 }\OperatorTok{=}\NormalTok{ np.outer(csi,csi)}

\NormalTok{plt.imshow(J1, origin}\OperatorTok{=}\StringTok{"lower"}\NormalTok{)}
\NormalTok{plt.xlabel(}\StringTok{\textquotesingle{}to neuron\textquotesingle{}}\NormalTok{)}
\NormalTok{plt.ylabel(}\StringTok{\textquotesingle{}from neuron\textquotesingle{}}\NormalTok{)}
\NormalTok{plt.colorbar(label}\OperatorTok{=}\StringTok{"connection strength"}\NormalTok{)}\OperatorTok{;}
\end{Highlighting}
\end{Shaded}

\begin{figure}[H]

{\centering \includegraphics{attractors_part2_files/figure-pdf/cell-14-output-1.pdf}

}

\end{figure}

Now reorder \(\xi\):

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{csi }\OperatorTok{=}\NormalTok{ np.sort(csi)}
\NormalTok{J1 }\OperatorTok{=}\NormalTok{ np.outer(csi,csi)}

\NormalTok{plt.imshow(J1, origin}\OperatorTok{=}\StringTok{"lower"}\NormalTok{)}
\NormalTok{plt.xlabel(}\StringTok{\textquotesingle{}to neuron\textquotesingle{}}\NormalTok{)}
\NormalTok{plt.ylabel(}\StringTok{\textquotesingle{}from neuron\textquotesingle{}}\NormalTok{)}
\NormalTok{plt.colorbar(label}\OperatorTok{=}\StringTok{"connection strength"}\NormalTok{)}\OperatorTok{;}
\end{Highlighting}
\end{Shaded}

\begin{figure}[H]

{\centering \includegraphics{attractors_part2_files/figure-pdf/cell-15-output-1.pdf}

}

\end{figure}

\hypertarget{dynamics-in-rank-1-rnn}{%
\subsection{Dynamics in rank-1 RNN}\label{dynamics-in-rank-1-rnn}}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{R1 }\OperatorTok{=}\NormalTok{ np.random.randn(Nn)}
\NormalTok{inds }\OperatorTok{=}\NormalTok{ np.argsort(R1)}
\NormalTok{R1n }\OperatorTok{=}\NormalTok{ R1[inds]}
\NormalTok{W }\OperatorTok{=}\NormalTok{ np.outer(R1n,R1n)}

\NormalTok{J0 }\OperatorTok{=} \OperatorTok{{-}}\FloatTok{5.2}
\NormalTok{J2 }\OperatorTok{=} \DecValTok{5}
\NormalTok{J }\OperatorTok{=}\NormalTok{ J0 }\OperatorTok{+}\NormalTok{ J2}\OperatorTok{*}\NormalTok{ W}

\NormalTok{x }\OperatorTok{=}\NormalTok{ np.linspace(}\OperatorTok{{-}}\DecValTok{1}\NormalTok{, }\DecValTok{1}\NormalTok{, Nn)}

\NormalTok{dt}\OperatorTok{=}\FloatTok{0.01}
\NormalTok{T}\OperatorTok{=}\DecValTok{3}
\NormalTok{time }\OperatorTok{=}\NormalTok{ np.arange(}\DecValTok{0}\NormalTok{,T,dt)}
\NormalTok{Nt }\OperatorTok{=} \BuiltInTok{len}\NormalTok{(time)}

\NormalTok{tau }\OperatorTok{=} \FloatTok{0.1}

\BuiltInTok{input} \OperatorTok{=}\NormalTok{ np.zeros((Nt,))}
\BuiltInTok{input}\NormalTok{[}\BuiltInTok{int}\NormalTok{(}\FloatTok{1.}\OperatorTok{/}\NormalTok{dt):}\BuiltInTok{int}\NormalTok{(}\FloatTok{1.5}\OperatorTok{/}\NormalTok{dt)] }\OperatorTok{=} \DecValTok{1}
    
\KeywordTok{def}\NormalTok{ get\_traces(stim):}

\NormalTok{    I }\OperatorTok{=}\NormalTok{ np.zeros((Nn,)) }
\NormalTok{    I[R1n}\OperatorTok{*}\NormalTok{stim}\OperatorTok{\textgreater{}}\DecValTok{0}\NormalTok{] }\OperatorTok{=} \DecValTok{3}

\NormalTok{    rate }\OperatorTok{=}\NormalTok{ np.zeros((Nt,Nn))}


    \ControlFlowTok{for}\NormalTok{ i }\KeywordTok{in} \BuiltInTok{range}\NormalTok{(Nt}\OperatorTok{{-}}\DecValTok{1}\NormalTok{): }
\NormalTok{        network\_inputs }\OperatorTok{=}\NormalTok{ np.dot(J, rate[i])}\OperatorTok{/}\NormalTok{Nn}
\NormalTok{        noise }\OperatorTok{=} \FloatTok{0.5}\OperatorTok{*}\NormalTok{np.random.randn(Nn,}\DecValTok{1}\NormalTok{).flatten()}
\NormalTok{        rate[i}\OperatorTok{+}\DecValTok{1}\NormalTok{] }\OperatorTok{=}\NormalTok{ rate[i] }\OperatorTok{+}\NormalTok{ dt}\OperatorTok{/}\NormalTok{tau }\OperatorTok{*}\NormalTok{ (}\OperatorTok{{-}}\NormalTok{rate[i] }\OperatorTok{+}\NormalTok{ fI(network\_inputs }\OperatorTok{+}\NormalTok{  noise }\OperatorTok{+} \BuiltInTok{input}\NormalTok{[i]}\OperatorTok{*}\NormalTok{I))}
        
    \ControlFlowTok{return}\NormalTok{ rate}

\CommentTok{\# Add traces, one for each slider step}

\NormalTok{frames }\OperatorTok{=}\NormalTok{ []}
\NormalTok{stims }\OperatorTok{=}\NormalTok{ np.random.choice([}\OperatorTok{{-}}\DecValTok{1}\NormalTok{, }\DecValTok{1}\NormalTok{], }\DecValTok{20}\NormalTok{)}

\ControlFlowTok{for}\NormalTok{ step, stim }\KeywordTok{in} \BuiltInTok{enumerate}\NormalTok{(stims):}

\NormalTok{    fig }\OperatorTok{=}\NormalTok{ make\_subplots(rows}\OperatorTok{=}\DecValTok{2}\NormalTok{, cols}\OperatorTok{=}\DecValTok{3}\NormalTok{,}
\NormalTok{      specs}\OperatorTok{=}\NormalTok{[[\{}\StringTok{\textquotesingle{}rowspan\textquotesingle{}}\NormalTok{: }\DecValTok{1}\NormalTok{, }\StringTok{\textquotesingle{}colspan\textquotesingle{}}\NormalTok{: }\DecValTok{2}\NormalTok{\}, }\VariableTok{None}\NormalTok{, \{}\StringTok{\textquotesingle{}rowspan\textquotesingle{}}\NormalTok{: }\DecValTok{2}\NormalTok{, }\StringTok{\textquotesingle{}colspan\textquotesingle{}}\NormalTok{: }\DecValTok{1}\NormalTok{\}],}
\NormalTok{       [\{}\StringTok{\textquotesingle{}rowspan\textquotesingle{}}\NormalTok{: }\DecValTok{1}\NormalTok{, }\StringTok{\textquotesingle{}colspan\textquotesingle{}}\NormalTok{: }\DecValTok{2}\NormalTok{\}, }\VariableTok{None}\NormalTok{, }\VariableTok{None}\NormalTok{]], }
\NormalTok{      row\_heights}\OperatorTok{=}\NormalTok{[}\FloatTok{0.3}\NormalTok{, }\FloatTok{0.7}\NormalTok{],}
\CommentTok{\#print\_grid=False,}
\NormalTok{      vertical\_spacing}\OperatorTok{=}\FloatTok{0.12}\NormalTok{,}
\NormalTok{      horizontal\_spacing}\OperatorTok{=}\FloatTok{0.09}\NormalTok{)}
    
\NormalTok{    rate }\OperatorTok{=}\NormalTok{ get\_traces(stim)}

\NormalTok{    fig.add\_trace(}
\NormalTok{        go.Scatter(}
\NormalTok{            visible}\OperatorTok{=}\VariableTok{True}\NormalTok{,}
\NormalTok{            line}\OperatorTok{=}\BuiltInTok{dict}\NormalTok{(color}\OperatorTok{=}\StringTok{"\#000000"}\NormalTok{, width}\OperatorTok{=}\DecValTok{4}\NormalTok{),}
\NormalTok{            name}\OperatorTok{=}\StringTok{""}\NormalTok{,}
\NormalTok{            x }\OperatorTok{=}\NormalTok{ time,}
\NormalTok{            y }\OperatorTok{=} \BuiltInTok{input}\NormalTok{,}
\NormalTok{            showlegend }\OperatorTok{=} \VariableTok{False}\NormalTok{),}
\NormalTok{            row }\OperatorTok{=} \DecValTok{1}\NormalTok{, col }\OperatorTok{=} \DecValTok{1}\NormalTok{)}
            
\NormalTok{    fig.add\_trace(go.Heatmap(z}\OperatorTok{=}\NormalTok{rate.T, }
\NormalTok{        x}\OperatorTok{=}\NormalTok{time, }
\NormalTok{        y}\OperatorTok{=}\NormalTok{x,}
\NormalTok{        zmin}\OperatorTok{=}\DecValTok{0}\NormalTok{,}
\NormalTok{        zmax}\OperatorTok{=}\DecValTok{10}\NormalTok{,}
\NormalTok{        zauto}\OperatorTok{=}\VariableTok{False}\NormalTok{,}
\NormalTok{        colorscale}\OperatorTok{=}\NormalTok{colorscale,}
\NormalTok{        showscale}\OperatorTok{=}\VariableTok{False}\NormalTok{), row}\OperatorTok{=}\DecValTok{2}\NormalTok{, col}\OperatorTok{=}\DecValTok{1}\NormalTok{)}

\NormalTok{    fig.add\_trace(}
\NormalTok{        go.Scatter(}
\NormalTok{            visible}\OperatorTok{=}\VariableTok{True}\NormalTok{,}
\NormalTok{            line}\OperatorTok{=}\BuiltInTok{dict}\NormalTok{(color}\OperatorTok{=}\StringTok{"\#000000"}\NormalTok{, width}\OperatorTok{=}\DecValTok{1}\NormalTok{),}
\NormalTok{            name}\OperatorTok{=}\StringTok{""}\NormalTok{,}
\NormalTok{            x }\OperatorTok{=}\NormalTok{ x,}
\NormalTok{            y }\OperatorTok{=}\NormalTok{ rate[}\OperatorTok{{-}}\DecValTok{1}\NormalTok{],}
\NormalTok{            showlegend }\OperatorTok{=} \VariableTok{False}\NormalTok{),}
\NormalTok{            row }\OperatorTok{=} \DecValTok{1}\NormalTok{, col }\OperatorTok{=} \DecValTok{3}\NormalTok{)}
            
\NormalTok{    fig.add\_trace(}
\NormalTok{        go.Scatter(}
\NormalTok{            x}\OperatorTok{=}\NormalTok{[stim, }\DecValTok{0}\NormalTok{], }
\NormalTok{        y}\OperatorTok{=}\NormalTok{[}\FloatTok{8.5}\NormalTok{, }\FloatTok{8.5}\NormalTok{],}
\NormalTok{            line}\OperatorTok{=}\BuiltInTok{dict}\NormalTok{(color}\OperatorTok{=}\StringTok{"\#550000"}\NormalTok{, width}\OperatorTok{=}\DecValTok{4}\NormalTok{),}
\NormalTok{        showlegend }\OperatorTok{=} \VariableTok{False}\NormalTok{),}
\NormalTok{            row }\OperatorTok{=} \DecValTok{1}\NormalTok{, col }\OperatorTok{=} \DecValTok{3}\NormalTok{)}

\NormalTok{    fig.update\_xaxes(title\_text}\OperatorTok{=}\StringTok{""}\NormalTok{, }\BuiltInTok{range}\OperatorTok{=}\NormalTok{[}\DecValTok{0}\NormalTok{, T], row}\OperatorTok{=}\DecValTok{1}\NormalTok{, col}\OperatorTok{=}\DecValTok{1}\NormalTok{)}
\NormalTok{    fig.update\_xaxes(title\_text}\OperatorTok{=}\StringTok{"time (s)"}\NormalTok{, }\BuiltInTok{range}\OperatorTok{=}\NormalTok{[}\DecValTok{0}\NormalTok{, T], row}\OperatorTok{=}\DecValTok{2}\NormalTok{, col}\OperatorTok{=}\DecValTok{1}\NormalTok{)}
\NormalTok{    fig.update\_yaxes(title\_text}\OperatorTok{=}\StringTok{"current"}\NormalTok{, row}\OperatorTok{=}\DecValTok{1}\NormalTok{, col}\OperatorTok{=}\DecValTok{1}\NormalTok{)}
\NormalTok{    fig.update\_yaxes(title\_text}\OperatorTok{=}\StringTok{"neurons"}\NormalTok{, }\BuiltInTok{range}\OperatorTok{=}\NormalTok{[}\OperatorTok{{-}}\DecValTok{1}\NormalTok{, }\DecValTok{1}\NormalTok{], row}\OperatorTok{=}\DecValTok{2}\NormalTok{, col}\OperatorTok{=}\DecValTok{1}\NormalTok{)}
\NormalTok{    fig.update\_xaxes(title\_text}\OperatorTok{=}\StringTok{"neurons"}\NormalTok{, }\BuiltInTok{range}\OperatorTok{=}\NormalTok{[}\OperatorTok{{-}}\DecValTok{1}\NormalTok{, }\DecValTok{1}\NormalTok{], row}\OperatorTok{=}\DecValTok{1}\NormalTok{, col}\OperatorTok{=}\DecValTok{3}\NormalTok{)}
\NormalTok{    fig.update\_yaxes(title\_text}\OperatorTok{=}\StringTok{"rate"}\NormalTok{, }\BuiltInTok{range}\OperatorTok{=}\NormalTok{[}\DecValTok{0}\NormalTok{, }\DecValTok{10}\NormalTok{], row}\OperatorTok{=}\DecValTok{1}\NormalTok{, col}\OperatorTok{=}\DecValTok{3}\NormalTok{)}

\NormalTok{    frames }\OperatorTok{+=}\NormalTok{ [go.Frame(data}\OperatorTok{=}\NormalTok{fig.data, layout}\OperatorTok{=}\NormalTok{fig.layout, name}\OperatorTok{=}\BuiltInTok{str}\NormalTok{(step))]}

    \CommentTok{\#\# store the first frame to reuse later}
    \ControlFlowTok{if}\NormalTok{ step }\OperatorTok{==} \DecValTok{0}\NormalTok{:}
\NormalTok{        first\_fig }\OperatorTok{=}\NormalTok{ fig}
        
\NormalTok{fig }\OperatorTok{=}\NormalTok{ go.Figure(frames}\OperatorTok{=}\NormalTok{frames)}

\CommentTok{\#\# add the first frame to the figure so it shows up initially}
\NormalTok{fig.add\_traces(first\_fig.data,)}
\NormalTok{fig.layout }\OperatorTok{=}\NormalTok{ first\_fig.layout}

\CommentTok{\#\# the rest is coped from the plotly documentation example on mri volume slices}
\KeywordTok{def}\NormalTok{ frame\_args(duration):}
    \ControlFlowTok{return}\NormalTok{ \{}
            \StringTok{"frame"}\NormalTok{: \{}\StringTok{"duration"}\NormalTok{: duration\},}
            \StringTok{"mode"}\NormalTok{: }\StringTok{"immediate"}\NormalTok{,}
            \StringTok{"fromcurrent"}\NormalTok{: }\VariableTok{True}\NormalTok{,}
            \StringTok{"transition"}\NormalTok{: \{}\StringTok{"duration"}\NormalTok{: }\DecValTok{0}\NormalTok{, }\StringTok{"easing"}\NormalTok{: }\StringTok{"linear"}\NormalTok{\},}
\NormalTok{        \}}

\NormalTok{sliders }\OperatorTok{=}\NormalTok{ [}
\NormalTok{            \{}
                \StringTok{"pad"}\NormalTok{: \{}\StringTok{"b"}\NormalTok{: }\DecValTok{10}\NormalTok{, }\StringTok{"t"}\NormalTok{: }\DecValTok{60}\NormalTok{\},}
                \StringTok{"len"}\NormalTok{: }\FloatTok{0.9}\NormalTok{,}
                \StringTok{"x"}\NormalTok{: }\FloatTok{0.1}\NormalTok{,}
                \StringTok{"y"}\NormalTok{: }\DecValTok{0}\NormalTok{,}
                \StringTok{"steps"}\NormalTok{: [}
\NormalTok{                    \{}
                        \StringTok{"args"}\NormalTok{: [[f.name], frame\_args(}\DecValTok{2000}\NormalTok{)],}
                        \StringTok{"label"}\NormalTok{: }\BuiltInTok{str}\NormalTok{(k),}
                        \StringTok{"method"}\NormalTok{: }\StringTok{"animate"}\NormalTok{,}
\NormalTok{                    \}}
                    \ControlFlowTok{for}\NormalTok{ k, f }\KeywordTok{in} \BuiltInTok{enumerate}\NormalTok{(fig.frames)}
\NormalTok{                ],}
\NormalTok{            \}}
\NormalTok{        ]}

\NormalTok{fig.update\_layout(}
\NormalTok{         title}\OperatorTok{=}\StringTok{\textquotesingle{}\textquotesingle{}}\NormalTok{,}
\NormalTok{         width}\OperatorTok{=}\DecValTok{1000}\NormalTok{,}
\NormalTok{         height}\OperatorTok{=}\DecValTok{500}\NormalTok{,}
\NormalTok{         autosize}\OperatorTok{=}\VariableTok{False}\NormalTok{,}
\NormalTok{         margin}\OperatorTok{=}\BuiltInTok{dict}\NormalTok{(t}\OperatorTok{=}\DecValTok{0}\NormalTok{, b}\OperatorTok{=}\DecValTok{0}\NormalTok{, l}\OperatorTok{=}\DecValTok{0}\NormalTok{, r}\OperatorTok{=}\DecValTok{0}\NormalTok{),}
\NormalTok{         hovermode}\OperatorTok{=}\VariableTok{False}\NormalTok{,}
\NormalTok{         updatemenus }\OperatorTok{=}\NormalTok{ [}
\NormalTok{            \{}
                \StringTok{"buttons"}\NormalTok{: [}
\NormalTok{                    \{}
                        \StringTok{"args"}\NormalTok{: [}\VariableTok{None}\NormalTok{, frame\_args(}\DecValTok{2000}\NormalTok{)],}
                        \StringTok{"label"}\NormalTok{: }\StringTok{"\&\#9654;"}\NormalTok{, }\CommentTok{\# play symbol}
                        \StringTok{"method"}\NormalTok{: }\StringTok{"animate"}\NormalTok{,}
\NormalTok{                    \},}
\NormalTok{                    \{}
                        \StringTok{"args"}\NormalTok{: [[}\VariableTok{None}\NormalTok{], frame\_args(}\DecValTok{2000}\NormalTok{)],}
                        \StringTok{"label"}\NormalTok{: }\StringTok{"\&\#9724;"}\NormalTok{, }\CommentTok{\# pause symbol}
                        \StringTok{"method"}\NormalTok{: }\StringTok{"animate"}\NormalTok{,}
\NormalTok{                    \},}
\NormalTok{                ],}
                \StringTok{"direction"}\NormalTok{: }\StringTok{"left"}\NormalTok{,}
                \StringTok{"pad"}\NormalTok{: \{}\StringTok{"r"}\NormalTok{: }\DecValTok{10}\NormalTok{, }\StringTok{"t"}\NormalTok{: }\DecValTok{70}\NormalTok{\},}
                \StringTok{"type"}\NormalTok{: }\StringTok{"buttons"}\NormalTok{,}
                \StringTok{"x"}\NormalTok{: }\FloatTok{0.1}\NormalTok{,}
                \StringTok{"y"}\NormalTok{: }\DecValTok{0}\NormalTok{,}
\NormalTok{            \}}
\NormalTok{         ],}
\NormalTok{         sliders}\OperatorTok{=}\NormalTok{sliders}
\NormalTok{)}


\NormalTok{config }\OperatorTok{=}\NormalTok{ \{}\StringTok{\textquotesingle{}displayModeBar\textquotesingle{}}\NormalTok{: }\VariableTok{False}\NormalTok{\}}

\NormalTok{fig.show(config}\OperatorTok{=}\NormalTok{config)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
Unable to display output for mime type(s): application/vnd.plotly.v1+json, text/html
\end{verbatim}

\hypertarget{rank-2-rnn}{%
\subsection{Rank-2 RNN}\label{rank-2-rnn}}

\(\scriptstyle J_{ij} = \xi_i \xi_j + \psi_i \psi_j\)

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{csi }\OperatorTok{=}\NormalTok{ np.random.randn(Nn)}
\NormalTok{psi }\OperatorTok{=}\NormalTok{ np.random.randn(Nn)}
\NormalTok{J2 }\OperatorTok{=}\NormalTok{ np.outer(csi,csi) }\OperatorTok{+}\NormalTok{ np.outer(psi,psi)}

\NormalTok{plt.imshow(J2, origin}\OperatorTok{=}\StringTok{"lower"}\NormalTok{)}
\NormalTok{plt.xlabel(}\StringTok{\textquotesingle{}to neuron\textquotesingle{}}\NormalTok{)}
\NormalTok{plt.ylabel(}\StringTok{\textquotesingle{}from neuron\textquotesingle{}}\NormalTok{)}
\NormalTok{plt.colorbar(label}\OperatorTok{=}\StringTok{"connection strength"}\NormalTok{)}\OperatorTok{;}
\end{Highlighting}
\end{Shaded}

\begin{figure}[H]

{\centering \includegraphics{attractors_part2_files/figure-pdf/cell-17-output-1.pdf}

}

\end{figure}

Now reorder \(\xi + i \psi\):

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{ang }\OperatorTok{=}\NormalTok{ np.angle(csi}\OperatorTok{+}\OtherTok{1j}\OperatorTok{*}\NormalTok{psi)}
\NormalTok{inds }\OperatorTok{=}\NormalTok{ np.argsort(ang)}
\NormalTok{W }\OperatorTok{=}\NormalTok{ np.outer(csi[inds],csi[inds]) }\OperatorTok{+}\NormalTok{ np.outer(psi[inds],psi[inds])}

\NormalTok{plt.imshow(W, origin}\OperatorTok{=}\StringTok{"lower"}\NormalTok{)}
\NormalTok{plt.xlabel(}\StringTok{\textquotesingle{}to neuron\textquotesingle{}}\NormalTok{)}
\NormalTok{plt.ylabel(}\StringTok{\textquotesingle{}from neuron\textquotesingle{}}\NormalTok{)}
\NormalTok{plt.colorbar(label}\OperatorTok{=}\StringTok{"connection strength"}\NormalTok{)}\OperatorTok{;}
\end{Highlighting}
\end{Shaded}

\begin{figure}[H]

{\centering \includegraphics{attractors_part2_files/figure-pdf/cell-18-output-1.pdf}

}

\end{figure}

\hypertarget{dynamics-in-rank-2-rnn}{%
\subsection{Dynamics in rank-2 RNN}\label{dynamics-in-rank-2-rnn}}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{J0 }\OperatorTok{=} \OperatorTok{{-}}\FloatTok{5.2}
\CommentTok{\#J2 = 11.119}
\NormalTok{J2 }\OperatorTok{=} \FloatTok{11.11}
\NormalTok{J }\OperatorTok{=}\NormalTok{ J0 }\OperatorTok{+}\NormalTok{ J2}\OperatorTok{*}\NormalTok{ W}

\NormalTok{x }\OperatorTok{=}\NormalTok{ np.linspace(}\OperatorTok{{-}}\NormalTok{np.pi, np.pi, Nn, endpoint}\OperatorTok{=}\VariableTok{False}\NormalTok{)}

\NormalTok{dt}\OperatorTok{=}\FloatTok{0.01}
\NormalTok{T}\OperatorTok{=}\DecValTok{3}
\NormalTok{time }\OperatorTok{=}\NormalTok{ np.arange(}\DecValTok{0}\NormalTok{,T,dt)}
\NormalTok{Nt }\OperatorTok{=} \BuiltInTok{len}\NormalTok{(time)}

\NormalTok{tau }\OperatorTok{=} \FloatTok{0.1}

\BuiltInTok{input} \OperatorTok{=}\NormalTok{ np.zeros((Nt,))}
\BuiltInTok{input}\NormalTok{[}\BuiltInTok{int}\NormalTok{(}\FloatTok{1.}\OperatorTok{/}\NormalTok{dt):}\BuiltInTok{int}\NormalTok{(}\FloatTok{1.5}\OperatorTok{/}\NormalTok{dt)] }\OperatorTok{=} \DecValTok{1}


\CommentTok{\# routine to extract population vectors from matrix of rates}
\NormalTok{vecs }\OperatorTok{=}\NormalTok{ np.cos(ang[inds]) }\OperatorTok{+} \OtherTok{1j}\OperatorTok{*}\NormalTok{np.sin(ang[inds])}
\NormalTok{vecs }\OperatorTok{=}\NormalTok{ np.outer(np.ones((}\DecValTok{1}\NormalTok{,Nt)),vecs)}
\KeywordTok{def}\NormalTok{ decode(rate):}
\NormalTok{    res }\OperatorTok{=}\NormalTok{ np.}\BuiltInTok{sum}\NormalTok{(vecs}\OperatorTok{*}\NormalTok{rate, axis}\OperatorTok{=}\DecValTok{1}\NormalTok{)}
    \ControlFlowTok{return}\NormalTok{ np.angle(res)}
    
\KeywordTok{def}\NormalTok{ get\_traces(stimat):}

\NormalTok{    I }\OperatorTok{=} \DecValTok{2}\OperatorTok{*}\NormalTok{np.exp(}\DecValTok{4}\OperatorTok{*}\NormalTok{np.cos(x }\OperatorTok{{-}}\NormalTok{ stimat))}
\NormalTok{    rate }\OperatorTok{=}\NormalTok{ np.zeros((Nt,Nn))}


    \ControlFlowTok{for}\NormalTok{ i }\KeywordTok{in} \BuiltInTok{range}\NormalTok{(Nt}\OperatorTok{{-}}\DecValTok{1}\NormalTok{): }
\NormalTok{        network\_inputs }\OperatorTok{=}\NormalTok{ np.dot(J, rate[i])}\OperatorTok{/}\NormalTok{Nn}
\NormalTok{        noise }\OperatorTok{=} \FloatTok{0.13}\OperatorTok{*}\NormalTok{np.random.randn(Nn,}\DecValTok{1}\NormalTok{).flatten()}
\NormalTok{        rate[i}\OperatorTok{+}\DecValTok{1}\NormalTok{] }\OperatorTok{=}\NormalTok{ rate[i] }\OperatorTok{+}\NormalTok{ dt}\OperatorTok{/}\NormalTok{tau }\OperatorTok{*}\NormalTok{ (}\OperatorTok{{-}}\NormalTok{rate[i] }\OperatorTok{+}\NormalTok{ fI(network\_inputs }\OperatorTok{+}\NormalTok{  noise }\OperatorTok{+} \BuiltInTok{input}\NormalTok{[i]}\OperatorTok{*}\NormalTok{I))}
        
    \ControlFlowTok{return}\NormalTok{ rate}

\CommentTok{\# Add traces, one for each slider step}

\NormalTok{frames }\OperatorTok{=}\NormalTok{ []}
\NormalTok{stims }\OperatorTok{=}\NormalTok{ np.random.randint(}\OperatorTok{{-}}\DecValTok{180}\NormalTok{, }\DecValTok{180}\NormalTok{, }\DecValTok{20}\NormalTok{)}

\ControlFlowTok{for}\NormalTok{ step, stimat }\KeywordTok{in} \BuiltInTok{enumerate}\NormalTok{(stims):}

\NormalTok{    fig }\OperatorTok{=}\NormalTok{ make\_subplots(rows}\OperatorTok{=}\DecValTok{2}\NormalTok{, cols}\OperatorTok{=}\DecValTok{3}\NormalTok{,}
\NormalTok{      specs}\OperatorTok{=}\NormalTok{[[\{}\StringTok{\textquotesingle{}rowspan\textquotesingle{}}\NormalTok{: }\DecValTok{1}\NormalTok{, }\StringTok{\textquotesingle{}colspan\textquotesingle{}}\NormalTok{: }\DecValTok{2}\NormalTok{\}, }\VariableTok{None}\NormalTok{, \{}\StringTok{\textquotesingle{}rowspan\textquotesingle{}}\NormalTok{: }\DecValTok{2}\NormalTok{, }\StringTok{\textquotesingle{}colspan\textquotesingle{}}\NormalTok{: }\DecValTok{1}\NormalTok{\}],}
\NormalTok{       [\{}\StringTok{\textquotesingle{}rowspan\textquotesingle{}}\NormalTok{: }\DecValTok{1}\NormalTok{, }\StringTok{\textquotesingle{}colspan\textquotesingle{}}\NormalTok{: }\DecValTok{2}\NormalTok{\}, }\VariableTok{None}\NormalTok{, }\VariableTok{None}\NormalTok{]], }
\NormalTok{      row\_heights}\OperatorTok{=}\NormalTok{[}\FloatTok{0.3}\NormalTok{, }\FloatTok{0.7}\NormalTok{],}
\NormalTok{      vertical\_spacing}\OperatorTok{=}\FloatTok{0.12}\NormalTok{,}
\NormalTok{      horizontal\_spacing}\OperatorTok{=}\FloatTok{0.09}\NormalTok{)}
    
\NormalTok{    rate }\OperatorTok{=}\NormalTok{ get\_traces(np.deg2rad(stimat))}
\NormalTok{    enc }\OperatorTok{=}\NormalTok{ decode(rate)}

\NormalTok{    fig.add\_trace(}
\NormalTok{        go.Scatter(}
\NormalTok{            visible}\OperatorTok{=}\VariableTok{True}\NormalTok{,}
\NormalTok{            line}\OperatorTok{=}\BuiltInTok{dict}\NormalTok{(color}\OperatorTok{=}\StringTok{"\#000000"}\NormalTok{, width}\OperatorTok{=}\DecValTok{4}\NormalTok{),}
\NormalTok{            name}\OperatorTok{=}\StringTok{""}\NormalTok{,}
\NormalTok{            x }\OperatorTok{=}\NormalTok{ time,}
\NormalTok{            y }\OperatorTok{=} \BuiltInTok{input}\NormalTok{,}
\NormalTok{            showlegend }\OperatorTok{=} \VariableTok{False}\NormalTok{),}
\NormalTok{            row }\OperatorTok{=} \DecValTok{1}\NormalTok{, col }\OperatorTok{=} \DecValTok{1}\NormalTok{)}
            
\NormalTok{    fig.add\_trace(go.Heatmap(z}\OperatorTok{=}\NormalTok{rate.T, }
\NormalTok{        x}\OperatorTok{=}\NormalTok{time, }
\NormalTok{        y}\OperatorTok{=}\NormalTok{np.rad2deg(x),}
\NormalTok{        colorscale}\OperatorTok{=}\NormalTok{colorscale,}
\NormalTok{        showscale}\OperatorTok{=}\VariableTok{False}\NormalTok{), row}\OperatorTok{=}\DecValTok{2}\NormalTok{, col}\OperatorTok{=}\DecValTok{1}\NormalTok{)}
        
\NormalTok{    fig.add\_trace(go.Scatter(mode}\OperatorTok{=}\StringTok{"markers"}\NormalTok{,}
\NormalTok{            x}\OperatorTok{=}\NormalTok{[}\FloatTok{1.}\NormalTok{], }
\NormalTok{        y}\OperatorTok{=}\NormalTok{[stimat],}
\NormalTok{        marker\_symbol}\OperatorTok{=}\StringTok{"arrow{-}right"}\NormalTok{,}
\NormalTok{        marker\_color}\OperatorTok{=}\StringTok{"red"}\NormalTok{,}
\NormalTok{        marker\_size}\OperatorTok{=}\DecValTok{15}\NormalTok{,}
\NormalTok{        showlegend }\OperatorTok{=} \VariableTok{False}\NormalTok{), row}\OperatorTok{=}\DecValTok{2}\NormalTok{, col}\OperatorTok{=}\DecValTok{1}\NormalTok{)}
        
\NormalTok{    fig.add\_trace(}
\NormalTok{        go.Scatter(}
\NormalTok{            visible}\OperatorTok{=}\VariableTok{True}\NormalTok{,}
\NormalTok{            line}\OperatorTok{=}\BuiltInTok{dict}\NormalTok{(color}\OperatorTok{=}\StringTok{"magenta"}\NormalTok{, width}\OperatorTok{=}\DecValTok{2}\NormalTok{),}
\NormalTok{            name}\OperatorTok{=}\StringTok{""}\NormalTok{,}
\NormalTok{            x }\OperatorTok{=}\NormalTok{ time,}
\NormalTok{            y }\OperatorTok{=}\NormalTok{ np.rad2deg(enc),}
\NormalTok{            showlegend }\OperatorTok{=} \VariableTok{False}\NormalTok{),}
\NormalTok{            row }\OperatorTok{=} \DecValTok{2}\NormalTok{, col }\OperatorTok{=} \DecValTok{1}\NormalTok{)}

\NormalTok{    fig.add\_trace(}
\NormalTok{        go.Scatter(}
\NormalTok{            visible}\OperatorTok{=}\VariableTok{True}\NormalTok{,}
\NormalTok{            line}\OperatorTok{=}\BuiltInTok{dict}\NormalTok{(color}\OperatorTok{=}\StringTok{"\#000000"}\NormalTok{, width}\OperatorTok{=}\DecValTok{1}\NormalTok{),}
\NormalTok{            name}\OperatorTok{=}\StringTok{""}\NormalTok{,}
\NormalTok{            x }\OperatorTok{=}\NormalTok{ np.rad2deg(x),}
\NormalTok{            y }\OperatorTok{=}\NormalTok{ rate[}\OperatorTok{{-}}\DecValTok{1}\NormalTok{],}
\NormalTok{            showlegend }\OperatorTok{=} \VariableTok{False}\NormalTok{),}
\NormalTok{            row }\OperatorTok{=} \DecValTok{1}\NormalTok{, col }\OperatorTok{=} \DecValTok{3}\NormalTok{)}
            
\NormalTok{    fig.add\_trace(}
\NormalTok{        go.Scatter(mode}\OperatorTok{=}\StringTok{"markers"}\NormalTok{,}
\NormalTok{            x}\OperatorTok{=}\NormalTok{[stimat], }
\NormalTok{        y}\OperatorTok{=}\NormalTok{[}\FloatTok{30.}\NormalTok{],}
\NormalTok{        marker\_symbol}\OperatorTok{=}\StringTok{"arrow{-}down"}\NormalTok{,}
\NormalTok{        marker\_color}\OperatorTok{=}\StringTok{"red"}\NormalTok{,}
\NormalTok{        marker\_size}\OperatorTok{=}\DecValTok{15}\NormalTok{,}
\NormalTok{        showlegend }\OperatorTok{=} \VariableTok{False}\NormalTok{),}
\NormalTok{            row }\OperatorTok{=} \DecValTok{1}\NormalTok{, col }\OperatorTok{=} \DecValTok{3}\NormalTok{)}
            
\NormalTok{    fig.add\_trace(}
\NormalTok{        go.Scatter(mode}\OperatorTok{=}\StringTok{"markers"}\NormalTok{,}
\NormalTok{            x}\OperatorTok{=}\NormalTok{[np.rad2deg(enc[}\OperatorTok{{-}}\DecValTok{1}\NormalTok{])], }
\NormalTok{        y}\OperatorTok{=}\NormalTok{[}\FloatTok{33.}\NormalTok{],}
\NormalTok{        marker\_symbol}\OperatorTok{=}\StringTok{"arrow{-}down"}\NormalTok{,}
\NormalTok{        marker\_color}\OperatorTok{=}\StringTok{"magenta"}\NormalTok{,}
\NormalTok{        marker\_size}\OperatorTok{=}\DecValTok{15}\NormalTok{,}
\NormalTok{        showlegend }\OperatorTok{=} \VariableTok{False}\NormalTok{),}
\NormalTok{            row }\OperatorTok{=} \DecValTok{1}\NormalTok{, col }\OperatorTok{=} \DecValTok{3}\NormalTok{)}

\NormalTok{    fig.update\_xaxes(title\_text}\OperatorTok{=}\StringTok{""}\NormalTok{, }\BuiltInTok{range}\OperatorTok{=}\NormalTok{[}\DecValTok{0}\NormalTok{, T], row}\OperatorTok{=}\DecValTok{1}\NormalTok{, col}\OperatorTok{=}\DecValTok{1}\NormalTok{)}
\NormalTok{    fig.update\_xaxes(title\_text}\OperatorTok{=}\StringTok{"time (s)"}\NormalTok{, }\BuiltInTok{range}\OperatorTok{=}\NormalTok{[}\DecValTok{0}\NormalTok{, T], row}\OperatorTok{=}\DecValTok{2}\NormalTok{, col}\OperatorTok{=}\DecValTok{1}\NormalTok{)}
\NormalTok{    fig.update\_yaxes(title\_text}\OperatorTok{=}\StringTok{"current"}\NormalTok{, row}\OperatorTok{=}\DecValTok{1}\NormalTok{, col}\OperatorTok{=}\DecValTok{1}\NormalTok{)}
\NormalTok{    fig.update\_yaxes(title\_text}\OperatorTok{=}\StringTok{"neurons (deg)"}\NormalTok{, }\BuiltInTok{range}\OperatorTok{=}\NormalTok{[}\OperatorTok{{-}}\DecValTok{180}\NormalTok{, }\DecValTok{180}\NormalTok{], row}\OperatorTok{=}\DecValTok{2}\NormalTok{, col}\OperatorTok{=}\DecValTok{1}\NormalTok{)}
\NormalTok{    fig.update\_xaxes(title\_text}\OperatorTok{=}\StringTok{"neurons (deg)"}\NormalTok{, }\BuiltInTok{range}\OperatorTok{=}\NormalTok{[}\OperatorTok{{-}}\DecValTok{180}\NormalTok{, }\DecValTok{180}\NormalTok{], row}\OperatorTok{=}\DecValTok{1}\NormalTok{, col}\OperatorTok{=}\DecValTok{3}\NormalTok{)}
\NormalTok{    fig.update\_yaxes(title\_text}\OperatorTok{=}\StringTok{"rate"}\NormalTok{, row}\OperatorTok{=}\DecValTok{1}\NormalTok{, col}\OperatorTok{=}\DecValTok{3}\NormalTok{)}

\NormalTok{    frames }\OperatorTok{+=}\NormalTok{ [go.Frame(data}\OperatorTok{=}\NormalTok{fig.data, layout}\OperatorTok{=}\NormalTok{fig.layout, name}\OperatorTok{=}\BuiltInTok{str}\NormalTok{(step))]}

    \CommentTok{\#\# store the first frame to reuse later}
    \ControlFlowTok{if}\NormalTok{ step }\OperatorTok{==} \DecValTok{0}\NormalTok{:}
\NormalTok{        first\_fig }\OperatorTok{=}\NormalTok{ fig}
        
\NormalTok{fig }\OperatorTok{=}\NormalTok{ go.Figure(frames}\OperatorTok{=}\NormalTok{frames)}

\CommentTok{\#\# add the first frame to the figure so it shows up initially}
\NormalTok{fig.add\_traces(first\_fig.data,)}
\NormalTok{fig.layout }\OperatorTok{=}\NormalTok{ first\_fig.layout}

\CommentTok{\#\# the rest is coped from the plotly documentation example on mri volume slices}
\KeywordTok{def}\NormalTok{ frame\_args(duration):}
    \ControlFlowTok{return}\NormalTok{ \{}
            \StringTok{"frame"}\NormalTok{: \{}\StringTok{"duration"}\NormalTok{: duration\},}
            \StringTok{"mode"}\NormalTok{: }\StringTok{"immediate"}\NormalTok{,}
            \StringTok{"fromcurrent"}\NormalTok{: }\VariableTok{True}\NormalTok{,}
            \StringTok{"transition"}\NormalTok{: \{}\StringTok{"duration"}\NormalTok{: }\DecValTok{0}\NormalTok{, }\StringTok{"easing"}\NormalTok{: }\StringTok{"linear"}\NormalTok{\},}
\NormalTok{        \}}

\NormalTok{sliders }\OperatorTok{=}\NormalTok{ [}
\NormalTok{            \{}
                \StringTok{"pad"}\NormalTok{: \{}\StringTok{"b"}\NormalTok{: }\DecValTok{10}\NormalTok{, }\StringTok{"t"}\NormalTok{: }\DecValTok{60}\NormalTok{\},}
                \StringTok{"len"}\NormalTok{: }\FloatTok{0.9}\NormalTok{,}
                \StringTok{"x"}\NormalTok{: }\FloatTok{0.1}\NormalTok{,}
                \StringTok{"y"}\NormalTok{: }\DecValTok{0}\NormalTok{,}
                \StringTok{"steps"}\NormalTok{: [}
\NormalTok{                    \{}
                        \StringTok{"args"}\NormalTok{: [[f.name], frame\_args(}\DecValTok{2000}\NormalTok{)],}
                        \StringTok{"label"}\NormalTok{: }\BuiltInTok{str}\NormalTok{(k),}
                        \StringTok{"method"}\NormalTok{: }\StringTok{"animate"}\NormalTok{,}
\NormalTok{                    \}}
                    \ControlFlowTok{for}\NormalTok{ k, f }\KeywordTok{in} \BuiltInTok{enumerate}\NormalTok{(fig.frames)}
\NormalTok{                ],}
\NormalTok{            \}}
\NormalTok{        ]}

\NormalTok{fig.update\_layout(}
\NormalTok{         title}\OperatorTok{=}\StringTok{\textquotesingle{}\textquotesingle{}}\NormalTok{,}
\NormalTok{         width}\OperatorTok{=}\DecValTok{1000}\NormalTok{,}
\NormalTok{         height}\OperatorTok{=}\DecValTok{500}\NormalTok{,}
\NormalTok{         autosize}\OperatorTok{=}\VariableTok{False}\NormalTok{,}
\NormalTok{         margin}\OperatorTok{=}\BuiltInTok{dict}\NormalTok{(t}\OperatorTok{=}\DecValTok{0}\NormalTok{, b}\OperatorTok{=}\DecValTok{0}\NormalTok{, l}\OperatorTok{=}\DecValTok{0}\NormalTok{, r}\OperatorTok{=}\DecValTok{0}\NormalTok{),}
\NormalTok{         hovermode}\OperatorTok{=}\VariableTok{False}\NormalTok{,}
\NormalTok{         updatemenus }\OperatorTok{=}\NormalTok{ [}
\NormalTok{            \{}
                \StringTok{"buttons"}\NormalTok{: [}
\NormalTok{                    \{}
                        \StringTok{"args"}\NormalTok{: [}\VariableTok{None}\NormalTok{, frame\_args(}\DecValTok{2000}\NormalTok{)],}
                        \StringTok{"label"}\NormalTok{: }\StringTok{"\&\#9654;"}\NormalTok{, }\CommentTok{\# play symbol}
                        \StringTok{"method"}\NormalTok{: }\StringTok{"animate"}\NormalTok{,}
\NormalTok{                    \},}
\NormalTok{                    \{}
                        \StringTok{"args"}\NormalTok{: [[}\VariableTok{None}\NormalTok{], frame\_args(}\DecValTok{2000}\NormalTok{)],}
                        \StringTok{"label"}\NormalTok{: }\StringTok{"\&\#9724;"}\NormalTok{, }\CommentTok{\# pause symbol}
                        \StringTok{"method"}\NormalTok{: }\StringTok{"animate"}\NormalTok{,}
\NormalTok{                    \},}
\NormalTok{                ],}
                \StringTok{"direction"}\NormalTok{: }\StringTok{"left"}\NormalTok{,}
                \StringTok{"pad"}\NormalTok{: \{}\StringTok{"r"}\NormalTok{: }\DecValTok{10}\NormalTok{, }\StringTok{"t"}\NormalTok{: }\DecValTok{70}\NormalTok{\},}
                \StringTok{"type"}\NormalTok{: }\StringTok{"buttons"}\NormalTok{,}
                \StringTok{"x"}\NormalTok{: }\FloatTok{0.1}\NormalTok{,}
                \StringTok{"y"}\NormalTok{: }\DecValTok{0}\NormalTok{,}
\NormalTok{            \}}
\NormalTok{         ],}
\NormalTok{         sliders}\OperatorTok{=}\NormalTok{sliders}
\NormalTok{)}


\NormalTok{config }\OperatorTok{=}\NormalTok{ \{}\StringTok{\textquotesingle{}displayModeBar\textquotesingle{}}\NormalTok{: }\VariableTok{False}\NormalTok{\}}

\NormalTok{fig.show(config}\OperatorTok{=}\NormalTok{config)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
Unable to display output for mime type(s): application/vnd.plotly.v1+json, text/html
\end{verbatim}

\hypertarget{dynamics-in-rank-2-rnn-1}{%
\subsection{Dynamics in rank-2 RNN}\label{dynamics-in-rank-2-rnn-1}}

Stable bumps converge on a few fixed points: not truly ring attractor
dynamics

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{nsims}\OperatorTok{=}\DecValTok{100}
\NormalTok{dt}\OperatorTok{=}\FloatTok{0.01}
\NormalTok{T}\OperatorTok{=}\DecValTok{3}
\NormalTok{time }\OperatorTok{=}\NormalTok{ np.arange(}\DecValTok{0}\NormalTok{,T,dt)}
\NormalTok{Nt }\OperatorTok{=} \BuiltInTok{len}\NormalTok{(time)}

\NormalTok{endpoints }\OperatorTok{=}\NormalTok{ np.zeros((nsims,))}

\CommentTok{\# run the simulation multiple times}
\ControlFlowTok{for}\NormalTok{ n }\KeywordTok{in} \BuiltInTok{range}\NormalTok{(nsims):}

\NormalTok{    phase }\OperatorTok{=} \DecValTok{2}\OperatorTok{*}\NormalTok{np.pi}\OperatorTok{*}\NormalTok{np.random.rand()}
\NormalTok{    I }\OperatorTok{=} \DecValTok{2}\OperatorTok{*}\NormalTok{np.exp(}\DecValTok{4}\OperatorTok{*}\NormalTok{np.cos(ang[inds]}\OperatorTok{+}\NormalTok{phase))}

\NormalTok{    rate }\OperatorTok{=}\NormalTok{ np.zeros((Nt,Nn))}

\NormalTok{    tau }\OperatorTok{=} \FloatTok{0.1}

    \ControlFlowTok{for}\NormalTok{ i }\KeywordTok{in} \BuiltInTok{range}\NormalTok{(Nt}\OperatorTok{{-}}\DecValTok{1}\NormalTok{):}
        \ControlFlowTok{if}\NormalTok{ (i}\OperatorTok{\textless{}}\FloatTok{0.5}\OperatorTok{/}\NormalTok{dt): }
            \BuiltInTok{input}\OperatorTok{=}\NormalTok{I}
        \ControlFlowTok{else}\NormalTok{:}
            \BuiltInTok{input}\OperatorTok{=}\DecValTok{0}
\NormalTok{        network\_inputs }\OperatorTok{=}\NormalTok{ np.dot(J, rate[i])}\OperatorTok{/}\NormalTok{Nn}
\NormalTok{        noise }\OperatorTok{=} \FloatTok{0.13}\OperatorTok{*}\NormalTok{np.random.randn(Nn,}\DecValTok{1}\NormalTok{).flatten()}
\NormalTok{        rate[i}\OperatorTok{+}\DecValTok{1}\NormalTok{] }\OperatorTok{=}\NormalTok{ rate[i] }\OperatorTok{+}\NormalTok{ dt}\OperatorTok{/}\NormalTok{tau }\OperatorTok{*}\NormalTok{ (}\OperatorTok{{-}}\NormalTok{rate[i] }\OperatorTok{+}\NormalTok{ fI(network\_inputs }\OperatorTok{+} \BuiltInTok{input} \OperatorTok{+}\NormalTok{ noise))}
    
\NormalTok{    trace }\OperatorTok{=}\NormalTok{ decode(rate)}

\NormalTok{    plt.plot(time, trace)}
\NormalTok{    plt.xlabel(}\StringTok{"time since stimulus (s)"}\NormalTok{)}
\NormalTok{    plt.ylabel(}\StringTok{"decoded angle (deg)"}\NormalTok{)}

\NormalTok{    endpoints[n] }\OperatorTok{=}\NormalTok{ trace[}\OperatorTok{{-}}\DecValTok{1}\NormalTok{]}
\end{Highlighting}
\end{Shaded}

\begin{figure}[H]

{\centering \includegraphics{attractors_part2_files/figure-pdf/cell-20-output-1.pdf}

}

\end{figure}

\hypertarget{are-ring-attractors-biologically-plausible}{%
\subsection{Are ring attractors biologically
plausible?}\label{are-ring-attractors-biologically-plausible}}

\begin{itemize}
\item
  cellular homeostatic mechanisms:
  \href{https://doi.org/10.1016/s0896-6273(03)00255-1}{Renart et al
  2003}
\item
  slow synapses: \href{https://doi.org/10.3389/fncom.2011.00040}{Istkov
  et al 2011};
  \href{https://doi.org/10.1523/JNEUROSCI.3455-12.2013}{Hansel and Mato
  2013}
\item
  connectivity training:
  \href{https://doi.org/10.1016/j.celrep.2022.110612}{Darshan and
  Rivkind 2022}; \href{https://doi.org/10.1101/2025.01.26.634933}{Clark
  et al 2025}
\item
  efficient coding? \href{https://doi.org/10.1162/NECO_a_00638}{Ganguli
  Simoncelli 2014}; \href{https://doi.org/10.7554/eLife.95160}{Yang et
  al 2024}
\end{itemize}

\hypertarget{end-of-part-2}{%
\section{End of part 2}\label{end-of-part-2}}



\end{document}
